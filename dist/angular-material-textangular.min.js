!function(e,t){"function"==typeof define&&define.amd?define(e):"undefined"!=typeof module&&"object"==typeof exports?module.exports=e():t.rangy=e()}(function(){function e(e,t){var n=typeof e[t];return n==N||!(n!=C||!e[t])||"unknown"==n}function t(e,t){return!(typeof e[t]!=C||!e[t])}function n(e,t){return typeof e[t]!=E}function r(e){return function(t,n){for(var r=n.length;r--;)if(!e(t,n[r]))return!1;return!0}}function o(e){return e&&O(e,T)&&D(e,w)}function i(e){return t(e,"body")?e.body:e.getElementsByTagName("body")[0]}function a(t){typeof console!=E&&e(console,"log")&&console.log(t)}function s(e,t){b&&t?alert(e):a(e)}function c(e){I.initialized=!0,I.supported=!1,s("Rangy is not supported in this environment. Reason: "+e,I.config.alertOnFail)}function d(e){s("Rangy warning: "+e,I.config.alertOnWarn)}function f(e){return e.message||e.description||String(e)}function u(){if(b&&!I.initialized){var t,n=!1,r=!1;e(document,"createRange")&&(t=document.createRange(),O(t,y)&&D(t,S)&&(n=!0));var s=i(document);if(!s||"body"!=s.nodeName.toLowerCase())return void c("No body element found");if(s&&e(s,"createTextRange")&&(t=s.createTextRange(),o(t)&&(r=!0)),!n&&!r)return void c("Neither Range nor TextRange are available");I.initialized=!0,I.features={implementsDomRange:n,implementsTextRange:r};var d,u;for(var l in x)(d=x[l])instanceof p&&d.init(d,I);for(var h=0,g=M.length;g>h;++h)try{M[h](I)}catch(m){u="Rangy init listener threw an exception. Continuing. Detail: "+f(m),a(u)}}}function l(e,t,n){n&&(e+=" in module "+n.name),I.warn("DEPRECATED: "+e+" is deprecated. Please use "+t+" instead.")}function h(e,t,n,r){e[t]=function(){return l(t,n,r),e[n].apply(e,P.toArray(arguments))}}function g(e){e=e||window,u();for(var t=0,n=k.length;n>t;++t)k[t](e)}function p(e,t,n){this.name=e,this.dependencies=t,this.initialized=!1,this.supported=!1,this.initializer=n}function m(e,t,n){var r=new p(e,t,function(t){if(!t.initialized){t.initialized=!0;try{n(I,t),t.supported=!0}catch(r){var o="Module '"+e+"' failed to load: "+f(r);a(o),r.stack&&a(r.stack)}}});return x[e]=r,r}function R(){}function v(){}var C="object",N="function",E="undefined",S=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],y=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],w=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],T=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"],O=r(e),_=r(t),D=r(n),A=[].forEach?function(e,t){e.forEach(t)}:function(e,t){for(var n=0,r=e.length;r>n;++n)t(e[n],n)},x={},b=typeof window!=E&&typeof document!=E,P={isHostMethod:e,isHostObject:t,isHostProperty:n,areHostMethods:O,areHostObjects:_,areHostProperties:D,isTextRange:o,getBody:i,forEach:A},I={version:"1.3.0",initialized:!1,isBrowser:b,supported:!0,util:P,features:{},modules:x,config:{alertOnFail:!1,alertOnWarn:!1,preferTextRange:!1,autoInitialize:typeof rangyAutoInitialize==E?!0:rangyAutoInitialize}};I.fail=c,I.warn=d;var B;({}).hasOwnProperty?(P.extend=B=function(e,t,n){var r,o;for(var i in t)t.hasOwnProperty(i)&&(r=e[i],o=t[i],n&&null!==r&&"object"==typeof r&&null!==o&&"object"==typeof o&&B(r,o,!0),e[i]=o);return t.hasOwnProperty("toString")&&(e.toString=t.toString),e},P.createOptions=function(e,t){var n={};return B(n,t),e&&B(n,e),n}):c("hasOwnProperty not supported"),b||c("Rangy can only run in a browser"),function(){var e;if(b){var t=document.createElement("div");t.appendChild(document.createElement("span"));var n=[].slice;try{1==n.call(t.childNodes,0)[0].nodeType&&(e=function(e){return n.call(e,0)})}catch(r){}}e||(e=function(e){for(var t=[],n=0,r=e.length;r>n;++n)t[n]=e[n];return t}),P.toArray=e}();var H;b&&(e(document,"addEventListener")?H=function(e,t,n){e.addEventListener(t,n,!1)}:e(document,"attachEvent")?H=function(e,t,n){e.attachEvent("on"+t,n)}:c("Document does not have required addEventListener or attachEvent method"),P.addListener=H);var M=[];P.deprecationNotice=l,P.createAliasForDeprecatedMethod=h,I.init=u,I.addInitListener=function(e){I.initialized?e(I):M.push(e)};var k=[];I.addShimListener=function(e){k.push(e)},b&&(I.shim=I.createMissingNativeApi=g,h(I,"createMissingNativeApi","shim")),p.prototype={init:function(){for(var e,t,n=this.dependencies||[],r=0,o=n.length;o>r;++r){if(t=n[r],e=x[t],!(e&&e instanceof p))throw new Error("required module '"+t+"' not found");if(e.init(),!e.supported)throw new Error("required module '"+t+"' not supported")}this.initializer(this)},fail:function(e){throw this.initialized=!0,this.supported=!1,new Error(e)},warn:function(e){I.warn("Module "+this.name+": "+e)},deprecationNotice:function(e,t){I.warn("DEPRECATED: "+e+" in module "+this.name+" is deprecated. Please use "+t+" instead")},createError:function(e){return new Error("Error in Rangy "+this.name+" module: "+e)}},I.createModule=function(e){var t,n;2==arguments.length?(t=arguments[1],n=[]):(t=arguments[2],n=arguments[1]);var r=m(e,n,t);I.initialized&&I.supported&&r.init()},I.createCoreModule=function(e,t,n){m(e,t,n)},I.RangePrototype=R,I.rangePrototype=new R,I.selectionPrototype=new v,I.createCoreModule("DomUtil",[],function(e,t){function n(e){var t;return typeof e.namespaceURI==b||null===(t=e.namespaceURI)||"http://www.w3.org/1999/xhtml"==t}function r(e){var t=e.parentNode;return 1==t.nodeType?t:null}function o(e){for(var t=0;e=e.previousSibling;)++t;return t}function i(e){switch(e.nodeType){case 7:case 10:return 0;case 3:case 8:return e.length;default:return e.childNodes.length}}function a(e,t){var n,r=[];for(n=e;n;n=n.parentNode)r.push(n);for(n=t;n;n=n.parentNode)if(M(r,n))return n;return null}function s(e,t,n){for(var r=n?t:t.parentNode;r;){if(r===e)return!0;r=r.parentNode}return!1}function c(e,t){return s(e,t,!0)}function d(e,t,n){for(var r,o=n?e:e.parentNode;o;){if(r=o.parentNode,r===t)return o;o=r}return null}function f(e){var t=e.nodeType;return 3==t||4==t||8==t}function u(e){if(!e)return!1;var t=e.nodeType;return 3==t||8==t}function l(e,t){var n=t.nextSibling,r=t.parentNode;return n?r.insertBefore(e,n):r.appendChild(e),e}function h(e,t,n){var r=e.cloneNode(!1);if(r.deleteData(0,t),e.deleteData(t,e.length-t),l(r,e),n)for(var i,a=0;i=n[a++];)i.node==e&&i.offset>t?(i.node=r,i.offset-=t):i.node==e.parentNode&&i.offset>o(e)&&++i.offset;return r}function g(e){if(9==e.nodeType)return e;if(typeof e.ownerDocument!=b)return e.ownerDocument;if(typeof e.document!=b)return e.document;if(e.parentNode)return g(e.parentNode);throw t.createError("getDocument: no document found for node")}function p(e){var n=g(e);if(typeof n.defaultView!=b)return n.defaultView;if(typeof n.parentWindow!=b)return n.parentWindow;throw t.createError("Cannot get a window object for node")}function m(e){if(typeof e.contentDocument!=b)return e.contentDocument;if(typeof e.contentWindow!=b)return e.contentWindow.document;throw t.createError("getIframeDocument: No Document object found for iframe element")}function R(e){if(typeof e.contentWindow!=b)return e.contentWindow;if(typeof e.contentDocument!=b)return e.contentDocument.defaultView;throw t.createError("getIframeWindow: No Window object found for iframe element")}function v(e){return e&&P.isHostMethod(e,"setTimeout")&&P.isHostObject(e,"document")}function C(e,t,n){var r;if(e?P.isHostProperty(e,"nodeType")?r=1==e.nodeType&&"iframe"==e.tagName.toLowerCase()?m(e):g(e):v(e)&&(r=e.document):r=document,!r)throw t.createError(n+"(): Parameter must be a Window object or DOM node");return r}function N(e){for(var t;t=e.parentNode;)e=t;return e}function E(e,n,r,i){var s,c,f,u,l;if(e==r)return n===i?0:i>n?-1:1;if(s=d(r,e,!0))return n<=o(s)?-1:1;if(s=d(e,r,!0))return o(s)<i?-1:1;if(c=a(e,r),!c)throw new Error("comparePoints error: nodes have no common ancestor");if(f=e===c?c:d(e,c,!0),u=r===c?c:d(r,c,!0),f===u)throw t.createError("comparePoints got to case 4 and childA and childB are the same!");for(l=c.firstChild;l;){if(l===f)return-1;if(l===u)return 1;l=l.nextSibling}}function S(e){var t;try{return t=e.parentNode,!1}catch(n){return!0}}function y(e){if(!e)return"[No node]";if(k&&S(e))return"[Broken node]";if(f(e))return'"'+e.data+'"';if(1==e.nodeType){var t=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+t+">[index:"+o(e)+",length:"+e.childNodes.length+"]["+(e.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return e.nodeName}function w(e){for(var t,n=g(e).createDocumentFragment();t=e.firstChild;)n.appendChild(t);return n}function T(e,t,n){var r=I(e),o=e.createElement("div");o.contentEditable=""+!!n,t&&(o.innerHTML=t);var i=r.firstChild;return i?r.insertBefore(o,i):r.appendChild(o),o}function O(e){return e.parentNode.removeChild(e)}function _(e){this.root=e,this._next=e}function D(e){return new _(e)}function A(e,t){this.node=e,this.offset=t}function x(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}var b="undefined",P=e.util,I=P.getBody;P.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method"),P.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method");var B=document.createElement("div");P.areHostMethods(B,["insertBefore","appendChild","cloneNode"]||!P.areHostObjects(B,["previousSibling","nextSibling","childNodes","parentNode"]))||t.fail("Incomplete Element implementation"),P.isHostProperty(B,"innerHTML")||t.fail("Element is missing innerHTML property");var H=document.createTextNode("test");P.areHostMethods(H,["splitText","deleteData","insertData","appendData","cloneNode"]||!P.areHostObjects(B,["previousSibling","nextSibling","childNodes","parentNode"])||!P.areHostProperties(H,["data"]))||t.fail("Incomplete Text Node implementation");var M=function(e,t){for(var n=e.length;n--;)if(e[n]===t)return!0;return!1},k=!1;!function(){var t=document.createElement("b");t.innerHTML="1";var n=t.firstChild;t.innerHTML="<br />",k=S(n),e.features.crashyTextNodes=k}();var L;typeof window.getComputedStyle!=b?L=function(e,t){return p(e).getComputedStyle(e,null)[t]}:typeof document.documentElement.currentStyle!=b?L=function(e,t){return e.currentStyle?e.currentStyle[t]:""}:t.fail("No means of obtaining computed style properties found"),_.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e,t,n=this._current=this._next;if(this._current)if(e=n.firstChild)this._next=e;else{for(t=null;n!==this.root&&!(t=n.nextSibling);)n=n.parentNode;this._next=t}return this._current},detach:function(){this._current=this._next=this.root=null}},A.prototype={equals:function(e){return!!e&&this.node===e.node&&this.offset==e.offset},inspect:function(){return"[DomPosition("+y(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},x.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24},x.prototype.toString=function(){return this.message},e.dom={arrayContains:M,isHtmlNamespace:n,parentElement:r,getNodeIndex:o,getNodeLength:i,getCommonAncestor:a,isAncestorOf:s,isOrIsAncestorOf:c,getClosestAncestorIn:d,isCharacterDataNode:f,isTextOrCommentNode:u,insertAfter:l,splitDataNode:h,getDocument:g,getWindow:p,getIframeWindow:R,getIframeDocument:m,getBody:I,isWindow:v,getContentDocument:C,getRootContainer:N,comparePoints:E,isBrokenNode:S,inspectNode:y,getComputedStyleProperty:L,createTestElement:T,removeNode:O,fragmentFromNodeChildren:w,createIterator:D,DomPosition:A},e.DOMException=x}),I.createCoreModule("DomRange",["DomUtil"],function(e,t){function n(e,t){return 3!=e.nodeType&&(j(e,t.startContainer)||j(e,t.endContainer))}function r(e){return e.document||z(e.startContainer)}function o(e){return G(e.startContainer)}function i(e){return new k(e.parentNode,F(e))}function a(e){return new k(e.parentNode,F(e)+1)}function s(e,t,n){var r=11==e.nodeType?e.firstChild:e;return W(t)?n==t.length?H.insertAfter(e,t):t.parentNode.insertBefore(e,0==n?t:V(t,n)):n>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[n]),r}function c(e,t,n){if(T(e),T(t),r(t)!=r(e))throw new L("WRONG_DOCUMENT_ERR");var o=U(e.startContainer,e.startOffset,t.endContainer,t.endOffset),i=U(e.endContainer,e.endOffset,t.startContainer,t.startOffset);return n?0>=o&&i>=0:0>o&&i>0}function d(e){for(var t,n,o,i=r(e.range).createDocumentFragment();n=e.next();){if(t=e.isPartiallySelectedSubtree(),n=n.cloneNode(!t),t&&(o=e.getSubtreeIterator(),n.appendChild(d(o)),o.detach()),10==n.nodeType)throw new L("HIERARCHY_REQUEST_ERR");i.appendChild(n)}return i}function f(e,t,n){var r,o;n=n||{stop:!1};for(var i,a;i=e.next();)if(e.isPartiallySelectedSubtree()){if(t(i)===!1)return void(n.stop=!0);if(a=e.getSubtreeIterator(),f(a,t,n),a.detach(),n.stop)return}else for(r=H.createIterator(i);o=r.next();)if(t(o)===!1)return void(n.stop=!0)}function u(e){for(var t;e.next();)e.isPartiallySelectedSubtree()?(t=e.getSubtreeIterator(),u(t),t.detach()):e.remove()}function l(e){for(var t,n,o=r(e.range).createDocumentFragment();t=e.next();){if(e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),n=e.getSubtreeIterator(),t.appendChild(l(n)),n.detach()):e.remove(),10==t.nodeType)throw new L("HIERARCHY_REQUEST_ERR");o.appendChild(t)}return o}function h(e,t,n){var r,o=!(!t||!t.length),i=!!n;o&&(r=new RegExp("^("+t.join("|")+")$"));var a=[];return f(new p(e,!1),function(t){if((!o||r.test(t.nodeType))&&(!i||n(t))){var s=e.startContainer;if(t!=s||!W(s)||e.startOffset!=s.length){var c=e.endContainer;t==c&&W(c)&&0==e.endOffset||a.push(t)}}}),a}function g(e){var t="undefined"==typeof e.getName?"Range":e.getName();return"["+t+"("+H.inspectNode(e.startContainer)+":"+e.startOffset+", "+H.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function p(e,t){if(this.range=e,this.clonePartiallySelectedTextNodes=t,!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var n=e.commonAncestorContainer;this.sc===this.ec&&W(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==n||W(this.sc)?q(this.sc,n,!0):this.sc.childNodes[this.so],this._last=this.ec!==n||W(this.ec)?q(this.ec,n,!0):this.ec.childNodes[this.eo-1])}}function m(e){return function(t,n){for(var r,o=n?t:t.parentNode;o;){if(r=o.nodeType,Q(e,r))return o;o=o.parentNode}return null}}function R(e,t){if(oe(e,t))throw new L("INVALID_NODE_TYPE_ERR")}function v(e,t){if(!Q(t,e.nodeType))throw new L("INVALID_NODE_TYPE_ERR")}function C(e,t){if(0>t||t>(W(e)?e.length:e.childNodes.length))throw new L("INDEX_SIZE_ERR")}function N(e,t){if(ne(e,!0)!==ne(t,!0))throw new L("WRONG_DOCUMENT_ERR")}function E(e){if(re(e,!0))throw new L("NO_MODIFICATION_ALLOWED_ERR")}function S(e,t){if(!e)throw new L(t)}function y(e,t){return t<=(W(e)?e.length:e.childNodes.length)}function w(e){return!!e.startContainer&&!!e.endContainer&&!(X&&(H.isBrokenNode(e.startContainer)||H.isBrokenNode(e.endContainer)))&&G(e.startContainer)==G(e.endContainer)&&y(e.startContainer,e.startOffset)&&y(e.endContainer,e.endOffset)}function T(e){if(!w(e))throw new Error("Range error: Range is not valid. This usually happens after DOM mutation. Range: ("+e.inspect()+")")}function O(e,t){T(e);var n=e.startContainer,r=e.startOffset,o=e.endContainer,i=e.endOffset,a=n===o;W(o)&&i>0&&i<o.length&&V(o,i,t),W(n)&&r>0&&r<n.length&&(n=V(n,r,t),a?(i-=r,o=n):o==n.parentNode&&i>=F(n)&&i++,r=0),e.setStartAndEnd(n,r,o,i)}function _(e){T(e);var t=e.commonAncestorContainer.parentNode.cloneNode(!1);return t.appendChild(e.cloneContents()),t.innerHTML}function D(e){e.START_TO_START=fe,e.START_TO_END=ue,e.END_TO_END=le,e.END_TO_START=he,e.NODE_BEFORE=ge,e.NODE_AFTER=pe,e.NODE_BEFORE_AND_AFTER=me,e.NODE_INSIDE=Re}function A(e){D(e),D(e.prototype)}function x(e,t){return function(){T(this);var n,r,o=this.startContainer,i=this.startOffset,s=this.commonAncestorContainer,c=new p(this,!0);o!==s&&(n=q(o,s,!0),r=a(n),o=r.node,i=r.offset),f(c,E),c.reset();var d=e(c);return c.detach(),t(this,o,i,o,i),d}}function b(t,r){function o(e,t){return function(n){v(n,$),v(G(n),J);var r=(e?i:a)(n);(t?s:c)(this,r.node,r.offset)}}function s(e,t,n){var o=e.endContainer,i=e.endOffset;t===e.startContainer&&n===e.startOffset||(G(t)==G(o)&&1!=U(t,n,o,i)||(o=t,i=n),r(e,t,n,o,i))}function c(e,t,n){var o=e.startContainer,i=e.startOffset;t===e.endContainer&&n===e.endOffset||(G(t)==G(o)&&-1!=U(t,n,o,i)||(o=t,i=n),r(e,o,i,t,n))}var d=function(){};d.prototype=e.rangePrototype,t.prototype=new d,M.extend(t.prototype,{setStart:function(e,t){R(e,!0),C(e,t),s(this,e,t)},setEnd:function(e,t){R(e,!0),C(e,t),c(this,e,t)},setStartAndEnd:function(){var e=arguments,t=e[0],n=e[1],o=t,i=n;switch(e.length){case 3:i=e[2];break;case 4:o=e[2],i=e[3]}r(this,t,n,o,i)},setBoundary:function(e,t,n){this["set"+(n?"Start":"End")](e,t)},setStartBefore:o(!0,!0),setStartAfter:o(!1,!0),setEndBefore:o(!0,!1),setEndAfter:o(!1,!1),collapse:function(e){T(this),e?r(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):r(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){R(e,!0),r(this,e,0,e,Y(e))},selectNode:function(e){R(e,!1),v(e,$);var t=i(e),n=a(e);r(this,t.node,t.offset,n.node,n.offset)},extractContents:x(l,r),deleteContents:x(u,r),canSurroundContents:function(){T(this),E(this.startContainer),E(this.endContainer);var e=new p(this,!0),t=e._first&&n(e._first,this)||e._last&&n(e._last,this);return e.detach(),!t},splitBoundaries:function(){O(this)},splitBoundariesPreservingPositions:function(e){O(this,e)},normalizeBoundaries:function(){T(this);var e,t=this.startContainer,n=this.startOffset,o=this.endContainer,i=this.endOffset,a=function(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(o=e,i=e.length,e.appendData(t.data),Z(t))},s=function(e){var r=e.previousSibling;if(r&&r.nodeType==e.nodeType){t=e;var a=e.length;if(n=r.length,e.insertData(0,r.data),Z(r),t==o)i+=n,o=t;else if(o==e.parentNode){var s=F(e);i==s?(o=e,i=a):i>s&&i--}}},c=!0;if(W(o))i==o.length?a(o):0==i&&(e=o.previousSibling,e&&e.nodeType==o.nodeType&&(i=e.length,t==o&&(c=!1),e.appendData(o.data),Z(o),o=e));else{if(i>0){var d=o.childNodes[i-1];d&&W(d)&&a(d)}c=!this.collapsed}if(c){if(W(t))0==n?s(t):n==t.length&&(e=t.nextSibling,e&&e.nodeType==t.nodeType&&(o==e&&(o=t,i+=t.length),t.appendData(e.data),Z(e)));else if(n<t.childNodes.length){var f=t.childNodes[n];f&&W(f)&&s(f)}}else t=o,n=i;r(this,t,n,o,i)},collapseToPoint:function(e,t){R(e,!0),C(e,t),this.setStartAndEnd(e,t)}}),A(t)}function P(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:H.getCommonAncestor(e.startContainer,e.endContainer)}function I(e,t,n,r,o){e.startContainer=t,e.startOffset=n,e.endContainer=r,e.endOffset=o,e.document=H.getDocument(t),P(e)}function B(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,this.document=e,P(this)}var H=e.dom,M=e.util,k=H.DomPosition,L=e.DOMException,W=H.isCharacterDataNode,F=H.getNodeIndex,j=H.isOrIsAncestorOf,z=H.getDocument,U=H.comparePoints,V=H.splitDataNode,q=H.getClosestAncestorIn,Y=H.getNodeLength,Q=H.arrayContains,G=H.getRootContainer,X=e.features.crashyTextNodes,Z=H.removeNode;p.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,W(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e,t,n=this._current;!W(n)||n!==this.sc&&n!==this.ec?n.parentNode&&Z(n):(e=n===this.sc?this.so:0,t=n===this.ec?this.eo:n.length,e!=t&&n.deleteData(e,t-e))},isPartiallySelectedSubtree:function(){var e=this._current;return n(e,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode)e=this.range.cloneRange(),e.collapse(!1);else{e=new B(r(this.range));var t=this._current,n=t,o=0,i=t,a=Y(t);j(t,this.sc)&&(n=this.sc,o=this.so),j(t,this.ec)&&(i=this.ec,a=this.eo),I(e,n,o,i,a)}return new p(e,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var $=[1,3,4,5,7,8,10],J=[2,9,11],K=[5,6,10,12],ee=[1,3,4,5,7,8,10,11],te=[1,3,4,5,7,8],ne=m([9,11]),re=m(K),oe=m([6,10,12]),ie=document.createElement("style"),ae=!1;try{ie.innerHTML="<b>x</b>",ae=3==ie.firstChild.nodeType}catch(se){}e.features.htmlParsingConforms=ae;var ce=ae?function(e){var t=this.startContainer,n=z(t);if(!t)throw new L("INVALID_STATE_ERR");var r=null;return 1==t.nodeType?r=t:W(t)&&(r=H.parentElement(t)),r=null===r||"HTML"==r.nodeName&&H.isHtmlNamespace(z(r).documentElement)&&H.isHtmlNamespace(r)?n.createElement("body"):r.cloneNode(!1),r.innerHTML=e,H.fragmentFromNodeChildren(r)}:function(e){var t=r(this),n=t.createElement("body");return n.innerHTML=e,H.fragmentFromNodeChildren(n)},de=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],fe=0,ue=1,le=2,he=3,ge=0,pe=1,me=2,Re=3;M.extend(e.rangePrototype,{compareBoundaryPoints:function(e,t){T(this),N(this.startContainer,t.startContainer);var n,r,o,i,a=e==he||e==fe?"start":"end",s=e==ue||e==fe?"start":"end";return n=this[a+"Container"],r=this[a+"Offset"],o=t[s+"Container"],i=t[s+"Offset"],U(n,r,o,i)},insertNode:function(e){if(T(this),v(e,ee),E(this.startContainer),j(e,this.startContainer))throw new L("HIERARCHY_REQUEST_ERR");var t=s(e,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){T(this);var e,t;if(this.collapsed)return r(this).createDocumentFragment();if(this.startContainer===this.endContainer&&W(this.startContainer))return e=this.startContainer.cloneNode(!0),e.data=e.data.slice(this.startOffset,this.endOffset),t=r(this).createDocumentFragment(),t.appendChild(e),t;var n=new p(this,!0);return e=d(n),n.detach(),e},canSurroundContents:function(){T(this),E(this.startContainer),E(this.endContainer);var e=new p(this,!0),t=e._first&&n(e._first,this)||e._last&&n(e._last,this);return e.detach(),!t},surroundContents:function(e){if(v(e,te),!this.canSurroundContents())throw new L("INVALID_STATE_ERR");var t=this.extractContents();if(e.hasChildNodes())for(;e.lastChild;)e.removeChild(e.lastChild);s(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){T(this);for(var e,t=new B(r(this)),n=de.length;n--;)e=de[n],t[e]=this[e];return t},toString:function(){T(this);var e=this.startContainer;if(e===this.endContainer&&W(e))return 3==e.nodeType||4==e.nodeType?e.data.slice(this.startOffset,this.endOffset):"";var t=[],n=new p(this,!0);return f(n,function(e){3!=e.nodeType&&4!=e.nodeType||t.push(e.data)}),n.detach(),t.join("")},compareNode:function(e){T(this);var t=e.parentNode,n=F(e);if(!t)throw new L("NOT_FOUND_ERR");var r=this.comparePoint(t,n),o=this.comparePoint(t,n+1);return 0>r?o>0?me:ge:o>0?pe:Re},comparePoint:function(e,t){return T(this),S(e,"HIERARCHY_REQUEST_ERR"),N(e,this.startContainer),U(e,t,this.startContainer,this.startOffset)<0?-1:U(e,t,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:ce,toHtml:function(){return _(this)},intersectsNode:function(e,t){if(T(this),G(e)!=o(this))return!1;var n=e.parentNode,r=F(e);if(!n)return!0;var i=U(n,r,this.endContainer,this.endOffset),a=U(n,r+1,this.startContainer,this.startOffset);return t?0>=i&&a>=0:0>i&&a>0},isPointInRange:function(e,t){return T(this),S(e,"HIERARCHY_REQUEST_ERR"),N(e,this.startContainer),U(e,t,this.startContainer,this.startOffset)>=0&&U(e,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(e){return c(this,e,!1)},intersectsOrTouchesRange:function(e){return c(this,e,!0)},intersection:function(e){if(this.intersectsRange(e)){var t=U(this.startContainer,this.startOffset,e.startContainer,e.startOffset),n=U(this.endContainer,this.endOffset,e.endContainer,e.endOffset),r=this.cloneRange();return-1==t&&r.setStart(e.startContainer,e.startOffset),1==n&&r.setEnd(e.endContainer,e.endOffset),r}return null},union:function(e){if(this.intersectsOrTouchesRange(e)){var t=this.cloneRange();return-1==U(e.startContainer,e.startOffset,this.startContainer,this.startOffset)&&t.setStart(e.startContainer,e.startOffset),1==U(e.endContainer,e.endOffset,this.endContainer,this.endOffset)&&t.setEnd(e.endContainer,e.endOffset),t}throw new L("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,!1):this.compareNode(e)==Re},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,Y(e))<=0},containsRange:function(e){var t=this.intersection(e);return null!==t&&e.equals(t)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var n=t.getNodes([3]);if(n.length>0){t.setStart(n[0],0);var r=n.pop();return t.setEnd(r,r.length),this.containsRange(t)}return this.containsNodeContents(e)},getNodes:function(e,t){return T(this),h(this,e,t)},getDocument:function(){return r(this)},collapseBefore:function(e){this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){this.setStartAfter(e),this.collapse(!0)},getBookmark:function(t){var n=r(this),o=e.createRange(n);t=t||H.getBody(n),o.selectNodeContents(t);var i=this.intersection(o),a=0,s=0;return i&&(o.setEnd(i.startContainer,i.startOffset),a=o.toString().length,s=a+i.toString().length),{start:a,end:s,containerNode:t}},moveToBookmark:function(e){var t=e.containerNode,n=0;this.setStart(t,0),this.collapse(!0);for(var r,o,i,a,s=[t],c=!1,d=!1;!d&&(r=s.pop());)if(3==r.nodeType)o=n+r.length,!c&&e.start>=n&&e.start<=o&&(this.setStart(r,e.start-n),c=!0),c&&e.end>=n&&e.end<=o&&(this.setEnd(r,e.end-n),d=!0),n=o;else for(a=r.childNodes,i=a.length;i--;)s.push(a[i])},getName:function(){return"DomRange"},equals:function(e){return B.rangesEqual(this,e)},isValid:function(){return w(this)},inspect:function(){return g(this)},detach:function(){}}),b(B,I),M.extend(B,{rangeProperties:de,RangeIterator:p,copyComparisonConstants:A,createPrototypeRange:b,inspect:g,toHtml:_,getRangeDocument:r,rangesEqual:function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset}}),e.DomRange=B}),I.createCoreModule("WrappedRange",["DomRange"],function(e,t){var n,r,o=e.dom,i=e.util,a=o.DomPosition,s=e.DomRange,c=o.getBody,d=o.getContentDocument,f=o.isCharacterDataNode;if(e.features.implementsDomRange&&!function(){function r(e){for(var t,n=l.length;n--;)t=l[n],e[t]=e.nativeRange[t];e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset}function a(e,t,n,r,o){var i=e.startContainer!==t||e.startOffset!=n,a=e.endContainer!==r||e.endOffset!=o,s=!e.equals(e.nativeRange);(i||a||s)&&(e.setEnd(r,o),e.setStart(t,n))}var f,u,l=s.rangeProperties;n=function(e){if(!e)throw t.createError("WrappedRange: Range must be specified");this.nativeRange=e,r(this)},s.createPrototypeRange(n,a),f=n.prototype,f.selectNode=function(e){this.nativeRange.selectNode(e),r(this)},f.cloneContents=function(){return this.nativeRange.cloneContents()},f.surroundContents=function(e){this.nativeRange.surroundContents(e),r(this)},f.collapse=function(e){this.nativeRange.collapse(e),r(this)},f.cloneRange=function(){return new n(this.nativeRange.cloneRange())},f.refresh=function(){r(this)},f.toString=function(){return this.nativeRange.toString()};var h=document.createTextNode("test");c(document).appendChild(h);var g=document.createRange();g.setStart(h,0),g.setEnd(h,0);try{g.setStart(h,1),f.setStart=function(e,t){this.nativeRange.setStart(e,t),r(this)},f.setEnd=function(e,t){this.nativeRange.setEnd(e,t),r(this)},u=function(e){return function(t){this.nativeRange[e](t),r(this)}}}catch(p){f.setStart=function(e,t){try{this.nativeRange.setStart(e,t)}catch(n){this.nativeRange.setEnd(e,t),this.nativeRange.setStart(e,t)}r(this)},f.setEnd=function(e,t){try{this.nativeRange.setEnd(e,t)}catch(n){this.nativeRange.setStart(e,t),this.nativeRange.setEnd(e,t)}r(this)},u=function(e,t){return function(n){try{this.nativeRange[e](n)}catch(o){this.nativeRange[t](n),this.nativeRange[e](n)}r(this)}}}f.setStartBefore=u("setStartBefore","setEndBefore"),f.setStartAfter=u("setStartAfter","setEndAfter"),f.setEndBefore=u("setEndBefore","setStartBefore"),f.setEndAfter=u("setEndAfter","setStartAfter"),f.selectNodeContents=function(e){this.setStartAndEnd(e,0,o.getNodeLength(e))},g.selectNodeContents(h),g.setEnd(h,3);var m=document.createRange();m.selectNodeContents(h),m.setEnd(h,4),m.setStart(h,2),-1==g.compareBoundaryPoints(g.START_TO_END,m)&&1==g.compareBoundaryPoints(g.END_TO_START,m)?f.compareBoundaryPoints=function(e,t){return t=t.nativeRange||t,e==t.START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:f.compareBoundaryPoints=function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)};var R=document.createElement("div");R.innerHTML="123";var v=R.firstChild,C=c(document);C.appendChild(R),g.setStart(v,1),g.setEnd(v,2),g.deleteContents(),"13"==v.data&&(f.deleteContents=function(){this.nativeRange.deleteContents(),r(this)},f.extractContents=function(){var e=this.nativeRange.extractContents();return r(this),e}),C.removeChild(R),C=null,i.isHostMethod(g,"createContextualFragment")&&(f.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),c(document).removeChild(h),f.getName=function(){return"WrappedRange"},e.WrappedRange=n,e.createNativeRange=function(e){return e=d(e,t,"createNativeRange"),e.createRange()}}(),e.features.implementsTextRange){var u=function(e){var t=e.parentElement(),n=e.duplicate();n.collapse(!0);var r=n.parentElement();n=e.duplicate(),n.collapse(!1);var i=n.parentElement(),a=r==i?r:o.getCommonAncestor(r,i);return a==t?a:o.getCommonAncestor(t,a)},l=function(e){return 0==e.compareEndPoints("StartToEnd",e)},h=function(e,t,n,r,i){var s=e.duplicate();s.collapse(n);var c=s.parentElement();if(o.isOrIsAncestorOf(t,c)||(c=t),!c.canHaveHTML){var d=new a(c.parentNode,o.getNodeIndex(c));return{boundaryPosition:d,nodeInfo:{nodeIndex:d.offset,containerElement:d.node}}}var u=o.getDocument(c).createElement("span");u.parentNode&&o.removeNode(u);for(var l,h,g,p,m,R=n?"StartToStart":"StartToEnd",v=i&&i.containerElement==c?i.nodeIndex:0,C=c.childNodes.length,N=C,E=N;;){if(E==C?c.appendChild(u):c.insertBefore(u,c.childNodes[E]),s.moveToElementText(u),l=s.compareEndPoints(R,e),0==l||v==N)break;if(-1==l){if(N==v+1)break;v=E}else N=N==v+1?v:E;E=Math.floor((v+N)/2),c.removeChild(u)}if(m=u.nextSibling,-1==l&&m&&f(m)){s.setEndPoint(n?"EndToStart":"EndToEnd",e);var S;if(/[\r\n]/.test(m.data)){var y=s.duplicate(),w=y.text.replace(/\r\n/g,"\r").length;for(S=y.moveStart("character",w);-1==(l=y.compareEndPoints("StartToEnd",y));)S++,y.moveStart("character",1)}else S=s.text.length;p=new a(m,S)}else h=(r||!n)&&u.previousSibling,g=(r||n)&&u.nextSibling,p=g&&f(g)?new a(g,0):h&&f(h)?new a(h,h.data.length):new a(c,o.getNodeIndex(u));return o.removeNode(u),{boundaryPosition:p,nodeInfo:{nodeIndex:E,containerElement:c}}},g=function(e,t){var n,r,i,a,s=e.offset,d=o.getDocument(e.node),u=c(d).createTextRange(),l=f(e.node);return l?(n=e.node,r=n.parentNode):(a=e.node.childNodes,n=s<a.length?a[s]:null,r=e.node),i=d.createElement("span"),i.innerHTML="&#feff;",n?r.insertBefore(i,n):r.appendChild(i),u.moveToElementText(i),u.collapse(!t),r.removeChild(i),l&&u[t?"moveStart":"moveEnd"]("character",s),u};r=function(e){this.textRange=e,this.refresh()},r.prototype=new s(document),r.prototype.refresh=function(){
var e,t,n,r=u(this.textRange);l(this.textRange)?t=e=h(this.textRange,r,!0,!0).boundaryPosition:(n=h(this.textRange,r,!0,!1),e=n.boundaryPosition,t=h(this.textRange,r,!1,!1,n.nodeInfo).boundaryPosition),this.setStart(e.node,e.offset),this.setEnd(t.node,t.offset)},r.prototype.getName=function(){return"WrappedTextRange"},s.copyComparisonConstants(r);var p=function(e){if(e.collapsed)return g(new a(e.startContainer,e.startOffset),!0);var t=g(new a(e.startContainer,e.startOffset),!0),n=g(new a(e.endContainer,e.endOffset),!1),r=c(s.getRangeDocument(e)).createTextRange();return r.setEndPoint("StartToStart",t),r.setEndPoint("EndToEnd",n),r};if(r.rangeToTextRange=p,r.prototype.toTextRange=function(){return p(this)},e.WrappedTextRange=r,!e.features.implementsDomRange||e.config.preferTextRange){var m=function(e){return e("return this;")()}(Function);"undefined"==typeof m.Range&&(m.Range=r),e.createNativeRange=function(e){return e=d(e,t,"createNativeRange"),c(e).createTextRange()},e.WrappedRange=r}}e.createRange=function(n){return n=d(n,t,"createRange"),new e.WrappedRange(e.createNativeRange(n))},e.createRangyRange=function(e){return e=d(e,t,"createRangyRange"),new s(e)},i.createAliasForDeprecatedMethod(e,"createIframeRange","createRange"),i.createAliasForDeprecatedMethod(e,"createIframeRangyRange","createRangyRange"),e.addShimListener(function(t){var n=t.document;"undefined"==typeof n.createRange&&(n.createRange=function(){return e.createRange(n)}),n=t=null})}),I.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(e,t){function n(e){return"string"==typeof e?/^backward(s)?$/i.test(e):!!e}function r(e,n){if(e){if(D.isWindow(e))return e;if(e instanceof R)return e.win;var r=D.getContentDocument(e,t,n);return D.getWindow(r)}return window}function o(e){return r(e,"getWinSelection").getSelection()}function i(e){return r(e,"getDocSelection").document.selection}function a(e){var t=!1;return e.anchorNode&&(t=1==D.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)),t}function s(e,t,n){var r=n?"end":"start",o=n?"start":"end";e.anchorNode=t[r+"Container"],e.anchorOffset=t[r+"Offset"],e.focusNode=t[o+"Container"],e.focusOffset=t[o+"Offset"]}function c(e){var t=e.nativeSelection;e.anchorNode=t.anchorNode,e.anchorOffset=t.anchorOffset,e.focusNode=t.focusNode,e.focusOffset=t.focusOffset}function d(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0}function f(t){var n;return t instanceof b?(n=e.createNativeRange(t.getDocument()),n.setEnd(t.endContainer,t.endOffset),n.setStart(t.startContainer,t.startOffset)):t instanceof P?n=t.nativeRange:H.implementsDomRange&&t instanceof D.getWindow(t.startContainer).Range&&(n=t),n}function u(e){if(!e.length||1!=e[0].nodeType)return!1;for(var t=1,n=e.length;n>t;++t)if(!D.isAncestorOf(e[0],e[t]))return!1;return!0}function l(e){var n=e.getNodes();if(!u(n))throw t.createError("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return n[0]}function h(e){return!!e&&"undefined"!=typeof e.text}function g(e,t){var n=new P(t);e._ranges=[n],s(e,n,!1),e.rangeCount=1,e.isCollapsed=n.collapsed}function p(t){if(t._ranges.length=0,"None"==t.docSelection.type)d(t);else{var n=t.docSelection.createRange();if(h(n))g(t,n);else{t.rangeCount=n.length;for(var r,o=k(n.item(0)),i=0;i<t.rangeCount;++i)r=e.createRange(o),r.selectNode(n.item(i)),t._ranges.push(r);t.isCollapsed=1==t.rangeCount&&t._ranges[0].collapsed,s(t,t._ranges[t.rangeCount-1],!1)}}}function m(e,n){for(var r=e.docSelection.createRange(),o=l(n),i=k(r.item(0)),a=L(i).createControlRange(),s=0,c=r.length;c>s;++s)a.add(r.item(s));try{a.add(o)}catch(d){throw t.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}a.select(),p(e)}function R(e,t,n){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=n,this.refresh()}function v(e){e.win=e.anchorNode=e.focusNode=e._ranges=null,e.rangeCount=e.anchorOffset=e.focusOffset=0,e.detached=!0}function C(e,t){for(var n,r,o=te.length;o--;)if(n=te[o],r=n.selection,"deleteAll"==t)v(r);else if(n.win==e)return"delete"==t?(te.splice(o,1),!0):r;return"deleteAll"==t&&(te.length=0),null}function N(e,n){for(var r,o=k(n[0].startContainer),i=L(o).createControlRange(),a=0,s=n.length;s>a;++a){r=l(n[a]);try{i.add(r)}catch(c){throw t.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}i.select(),p(e)}function E(e,t){if(e.win.document!=k(t))throw new I("WRONG_DOCUMENT_ERR")}function S(t){return function(n,r){var o;this.rangeCount?(o=this.getRangeAt(0),o["set"+(t?"Start":"End")](n,r)):(o=e.createRange(this.win.document),o.setStartAndEnd(n,r)),this.setSingleRange(o,this.isBackward())}}function y(e){var t=[],n=new B(e.anchorNode,e.anchorOffset),r=new B(e.focusNode,e.focusOffset),o="function"==typeof e.getName?e.getName():"Selection";if("undefined"!=typeof e.rangeCount)for(var i=0,a=e.rangeCount;a>i;++i)t[i]=b.inspect(e.getRangeAt(i));return"["+o+"(Ranges: "+t.join(", ")+")(anchor: "+n.inspect()+", focus: "+r.inspect()+"]"}e.config.checkSelectionRanges=!0;var w,T,O="boolean",_="number",D=e.dom,A=e.util,x=A.isHostMethod,b=e.DomRange,P=e.WrappedRange,I=e.DOMException,B=D.DomPosition,H=e.features,M="Control",k=D.getDocument,L=D.getBody,W=b.rangesEqual,F=x(window,"getSelection"),j=A.isHostObject(document,"selection");H.implementsWinGetSelection=F,H.implementsDocSelection=j;var z=j&&(!F||e.config.preferTextRange);if(z)w=i,e.isSelectionValid=function(e){var t=r(e,"isSelectionValid").document,n=t.selection;return"None"!=n.type||k(n.createRange().parentElement())==t};else{if(!F)return t.fail("Neither document.selection or window.getSelection() detected."),!1;w=o,e.isSelectionValid=function(){return!0}}e.getNativeSelection=w;var U=w();if(!U)return t.fail("Native selection was null (possibly issue 138?)"),!1;var V=e.createNativeRange(document),q=L(document),Y=A.areHostProperties(U,["anchorNode","focusNode","anchorOffset","focusOffset"]);H.selectionHasAnchorAndFocus=Y;var Q=x(U,"extend");H.selectionHasExtend=Q;var G=typeof U.rangeCount==_;H.selectionHasRangeCount=G;var X=!1,Z=!0,$=Q?function(t,n){var r=b.getRangeDocument(n),o=e.createRange(r);o.collapseToPoint(n.endContainer,n.endOffset),t.addRange(f(o)),t.extend(n.startContainer,n.startOffset)}:null;A.areHostMethods(U,["addRange","getRangeAt","removeAllRanges"])&&typeof U.rangeCount==_&&H.implementsDomRange&&!function(){var t=window.getSelection();if(t){for(var n=t.rangeCount,r=n>1,o=[],i=a(t),s=0;n>s;++s)o[s]=t.getRangeAt(s);var c=D.createTestElement(document,"",!1),d=c.appendChild(document.createTextNode("   ")),f=document.createRange();if(f.setStart(d,1),f.collapse(!0),t.removeAllRanges(),t.addRange(f),Z=1==t.rangeCount,t.removeAllRanges(),!r){var u=window.navigator.appVersion.match(/Chrome\/(.*?) /);if(u&&parseInt(u[1])>=36)X=!1;else{var l=f.cloneRange();f.setStart(d,0),l.setEnd(d,3),l.setStart(d,2),t.addRange(f),t.addRange(l),X=2==t.rangeCount}}for(D.removeNode(c),t.removeAllRanges(),s=0;n>s;++s)0==s&&i?$?$(t,o[s]):(e.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),t.addRange(o[s])):t.addRange(o[s])}}(),H.selectionSupportsMultipleRanges=X,H.collapsedNonEditableSelectionsSupported=Z;var J,K=!1;q&&x(q,"createControlRange")&&(J=q.createControlRange(),A.areHostProperties(J,["item","add"])&&(K=!0)),H.implementsControlRange=K,T=Y?function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:function(e){return e.rangeCount?e.getRangeAt(e.rangeCount-1).collapsed:!1};var ee;x(U,"getRangeAt")?ee=function(e,t){try{return e.getRangeAt(t)}catch(n){return null}}:Y&&(ee=function(t){var n=k(t.anchorNode),r=e.createRange(n);return r.setStartAndEnd(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset),r.collapsed!==this.isCollapsed&&r.setStartAndEnd(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset),r}),R.prototype=e.selectionPrototype;var te=[],ne=function(e){if(e&&e instanceof R)return e.refresh(),e;e=r(e,"getNativeSelection");var t=C(e),n=w(e),o=j?i(e):null;return t?(t.nativeSelection=n,t.docSelection=o,t.refresh()):(t=new R(n,o,e),te.push({win:e,selection:t})),t};e.getSelection=ne,A.createAliasForDeprecatedMethod(e,"getIframeSelection","getSelection");var re=R.prototype;if(!z&&Y&&A.areHostMethods(U,["removeAllRanges","addRange"])){re.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),d(this)};var oe=function(e,t){$(e.nativeSelection,t),e.refresh()};G?re.addRange=function(t,r){if(K&&j&&this.docSelection.type==M)m(this,t);else if(n(r)&&Q)oe(this,t);else{var o;X?o=this.rangeCount:(this.removeAllRanges(),o=0);var i=f(t).cloneRange();try{this.nativeSelection.addRange(i)}catch(a){}if(this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==o+1){if(e.config.checkSelectionRanges){var c=ee(this.nativeSelection,this.rangeCount-1);c&&!W(c,t)&&(t=new P(c))}this._ranges[this.rangeCount-1]=t,s(this,t,se(this.nativeSelection)),this.isCollapsed=T(this)}else this.refresh()}}:re.addRange=function(e,t){n(t)&&Q?oe(this,e):(this.nativeSelection.addRange(f(e)),this.refresh())},re.setRanges=function(e){if(K&&j&&e.length>1)N(this,e);else{this.removeAllRanges();for(var t=0,n=e.length;n>t;++t)this.addRange(e[t])}}}else{if(!(x(U,"empty")&&x(V,"select")&&K&&z))return t.fail("No means of selecting a Range or TextRange was found"),!1;re.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var e;if(this.anchorNode)e=k(this.anchorNode);else if(this.docSelection.type==M){var t=this.docSelection.createRange();t.length&&(e=k(t.item(0)))}if(e){var n=L(e).createTextRange();n.select(),this.docSelection.empty()}}}catch(r){}d(this)},re.addRange=function(t){this.docSelection.type==M?m(this,t):(e.WrappedTextRange.rangeToTextRange(t).select(),this._ranges[0]=t,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,s(this,t,!1))},re.setRanges=function(e){this.removeAllRanges();var t=e.length;t>1?N(this,e):t&&this.addRange(e[0])}}re.getRangeAt=function(e){if(0>e||e>=this.rangeCount)throw new I("INDEX_SIZE_ERR");return this._ranges[e].cloneRange()};var ie;if(z)ie=function(t){var n;e.isSelectionValid(t.win)?n=t.docSelection.createRange():(n=L(t.win.document).createTextRange(),n.collapse(!0)),t.docSelection.type==M?p(t):h(n)?g(t,n):d(t)};else if(x(U,"getRangeAt")&&typeof U.rangeCount==_)ie=function(t){if(K&&j&&t.docSelection.type==M)p(t);else if(t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount,t.rangeCount){for(var n=0,r=t.rangeCount;r>n;++n)t._ranges[n]=new e.WrappedRange(t.nativeSelection.getRangeAt(n));s(t,t._ranges[t.rangeCount-1],se(t.nativeSelection)),t.isCollapsed=T(t)}else d(t)};else{if(!Y||typeof U.isCollapsed!=O||typeof V.collapsed!=O||!H.implementsDomRange)return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;ie=function(e){var t,n=e.nativeSelection;n.anchorNode?(t=ee(n,0),e._ranges=[t],e.rangeCount=1,c(e),e.isCollapsed=T(e)):d(e)}}re.refresh=function(e){var t=e?this._ranges.slice(0):null,n=this.anchorNode,r=this.anchorOffset;if(ie(this),e){var o=t.length;if(o!=this._ranges.length)return!0;if(this.anchorNode!=n||this.anchorOffset!=r)return!0;for(;o--;)if(!W(t[o],this._ranges[o]))return!0;return!1}};var ae=function(e,t){var n=e.getAllRanges();e.removeAllRanges();for(var r=0,o=n.length;o>r;++r)W(t,n[r])||e.addRange(n[r]);e.rangeCount||d(e)};K&&j?re.removeRange=function(e){if(this.docSelection.type==M){for(var t,n=this.docSelection.createRange(),r=l(e),o=k(n.item(0)),i=L(o).createControlRange(),a=!1,s=0,c=n.length;c>s;++s)t=n.item(s),t!==r||a?i.add(n.item(s)):a=!0;i.select(),p(this)}else ae(this,e)}:re.removeRange=function(e){ae(this,e)};var se;!z&&Y&&H.implementsDomRange?(se=a,re.isBackward=function(){return se(this)}):se=re.isBackward=function(){return!1},re.isBackwards=re.isBackward,re.toString=function(){for(var e=[],t=0,n=this.rangeCount;n>t;++t)e[t]=""+this._ranges[t];return e.join("")},re.collapse=function(t,n){E(this,t);var r=e.createRange(t);r.collapseToPoint(t,n),this.setSingleRange(r),this.isCollapsed=!0},re.collapseToStart=function(){if(!this.rangeCount)throw new I("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},re.collapseToEnd=function(){if(!this.rangeCount)throw new I("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},re.selectAllChildren=function(t){E(this,t);var n=e.createRange(t);n.selectNodeContents(t),this.setSingleRange(n)},re.deleteFromDocument=function(){if(K&&j&&this.docSelection.type==M){for(var e,t=this.docSelection.createRange();t.length;)e=t.item(0),t.remove(e),D.removeNode(e);this.refresh()}else if(this.rangeCount){var n=this.getAllRanges();if(n.length){this.removeAllRanges();for(var r=0,o=n.length;o>r;++r)n[r].deleteContents();this.addRange(n[o-1])}}},re.eachRange=function(e,t){for(var n=0,r=this._ranges.length;r>n;++n)if(e(this.getRangeAt(n)))return t},re.getAllRanges=function(){var e=[];return this.eachRange(function(t){e.push(t)}),e},re.setSingleRange=function(e,t){this.removeAllRanges(),this.addRange(e,t)},re.callMethodOnEachRange=function(e,t){var n=[];return this.eachRange(function(r){n.push(r[e].apply(r,t||[]))}),n},re.setStart=S(!0),re.setEnd=S(!1),e.rangePrototype.select=function(e){ne(this.getDocument()).setSingleRange(this,e)},re.changeEachRange=function(e){var t=[],n=this.isBackward();this.eachRange(function(n){e(n),t.push(n)}),this.removeAllRanges(),n&&1==t.length?this.addRange(t[0],"backward"):this.setRanges(t)},re.containsNode=function(e,t){return this.eachRange(function(n){return n.containsNode(e,t)},!0)||!1},re.getBookmark=function(e){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[e])}},re.moveToBookmark=function(t){for(var n,r,o=[],i=0;n=t.rangeBookmarks[i++];)r=e.createRange(this.win),r.moveToBookmark(n),o.push(r);t.backward?this.setSingleRange(o[0],"backward"):this.setRanges(o)},re.saveRanges=function(){return{backward:this.isBackward(),ranges:this.callMethodOnEachRange("cloneRange")}},re.restoreRanges=function(e){this.removeAllRanges();for(var t,n=0;t=e.ranges[n];++n)this.addRange(t,e.backward&&0==n)},re.toHtml=function(){var e=[];return this.eachRange(function(t){e.push(b.toHtml(t))}),e.join("")},H.implementsTextRange&&(re.getNativeTextRange=function(){var n;if(n=this.docSelection){var r=n.createRange();if(h(r))return r;throw t.createError("getNativeTextRange: selection is a control selection")}if(this.rangeCount>0)return e.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw t.createError("getNativeTextRange: selection contains no range")}),re.getName=function(){return"WrappedSelection"},re.inspect=function(){return y(this)},re.detach=function(){C(this.win,"delete"),v(this)},R.detachAll=function(){C(null,"deleteAll")},R.inspect=y,R.isDirectionBackward=n,e.Selection=R,e.selectionPrototype=re,e.addShimListener(function(e){"undefined"==typeof e.getSelection&&(e.getSelection=function(){return ne(e)}),e=null})});var L=!1,W=function(e){L||(L=!0,!I.initialized&&I.config.autoInitialize&&u())};return b&&("complete"==document.readyState?W():(e(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",W,!1),H(window,"load",W))),I},this);
!function(e,n){"function"==typeof define&&define.amd?define(["./rangy-core"],e):"undefined"!=typeof module&&"object"==typeof exports?module.exports=e(require("rangy")):e(n.rangy)}(function(e){return e.createModule("SaveRestore",["WrappedRange"],function(e,n){function r(e,n){return(n||document).getElementById(e)}function t(e,n){var r,t="selectionBoundary_"+ +new Date+"_"+(""+Math.random()).slice(2),a=m.getDocument(e.startContainer),o=e.cloneRange();return o.collapse(n),r=a.createElement("span"),r.id=t,r.style.lineHeight="0",r.style.display="none",r.className="rangySelectionBoundary",r.appendChild(a.createTextNode(k)),o.insertNode(r),r}function a(e,t,a,o){var s=r(a,e);s?(t[o?"setStartBefore":"setEndBefore"](s),p(s)):n.warn("Marker element has been removed. Cannot restore selection.")}function o(e,n){return n.compareBoundaryPoints(e.START_TO_START,e)}function s(n,r){var a,o,s=e.DomRange.getRangeDocument(n),i=n.toString(),d=v(r);return n.collapsed?(o=t(n,!1),{document:s,markerId:o.id,collapsed:!0}):(o=t(n,!1),a=t(n,!0),{document:s,startMarkerId:a.id,endMarkerId:o.id,collapsed:!1,backward:d,toString:function(){return"original text: '"+i+"', new text: '"+n.toString()+"'"}})}function i(t,o){var s=t.document;"undefined"==typeof o&&(o=!0);var i=e.createRange(s);if(t.collapsed){var d=r(t.markerId,s);if(d){d.style.display="inline";var l=d.previousSibling;l&&3==l.nodeType?(p(d),i.collapseToPoint(l,l.length)):(i.collapseBefore(d),p(d))}else n.warn("Marker element has been removed. Cannot restore selection.")}else a(s,i,t.startMarkerId,!0),a(s,i,t.endMarkerId,!1);return o&&i.normalizeBoundaries(),i}function d(n,t){var a,i,d=[],l=v(t);n=n.slice(0),n.sort(o);for(var c=0,u=n.length;u>c;++c)d[c]=s(n[c],l);for(c=u-1;c>=0;--c)a=n[c],i=e.DomRange.getRangeDocument(a),a.collapsed?a.collapseAfter(r(d[c].markerId,i)):(a.setEndBefore(r(d[c].endMarkerId,i)),a.setStartAfter(r(d[c].startMarkerId,i)));return d}function l(r){if(!e.isSelectionValid(r))return n.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus."),null;var t=e.getSelection(r),a=t.getAllRanges(),o=1==a.length&&t.isBackward(),s=d(a,o);return o?t.setSingleRange(a[0],o):t.setRanges(a),{win:r,rangeInfos:s,restored:!1}}function c(e){for(var n=[],r=e.length,t=r-1;t>=0;t--)n[t]=i(e[t],!0);return n}function u(n,r){if(!n.restored){var t=n.rangeInfos,a=e.getSelection(n.win),o=c(t),s=t.length;1==s&&r&&e.features.selectionHasExtend&&t[0].backward?(a.removeAllRanges(),a.addRange(o[0],!0)):a.setRanges(o),n.restored=!0}}function f(e,n){var t=r(n,e);t&&p(t)}function g(e){for(var n,r=e.rangeInfos,t=0,a=r.length;a>t;++t)n=r[t],n.collapsed?f(e.doc,n.markerId):(f(e.doc,n.startMarkerId),f(e.doc,n.endMarkerId))}var m=e.dom,p=m.removeNode,v=e.Selection.isDirectionBackward,k="\ufeff";e.util.extend(e,{saveRange:s,restoreRange:i,saveRanges:d,restoreRanges:c,saveSelection:l,restoreSelection:u,removeMarkerElement:f,removeMarkers:g})}),e},this);
!function(e,t,r){"use strict";function n(){this.$get=["$$sanitizeUri",function(e){return function(t){"undefined"!=typeof arguments[1]&&(arguments[1].version="taSanitize");var r=[];return s(t,h(r,function(t,r){return!/^unsafe/.test(e(t,r))})),r.join("")}}]}function i(e){var r=[],n=h(r,t.noop);return n.chars(e),r.join("")}function a(e){var t,r={},n=e.split(",");for(t=0;t<n.length;t++)r[n[t]]=!0;return r}function s(e,r){function n(e,n,a,s){if(n=t.lowercase(n),T[n])for(;u.last()&&E[u.last()];)i("",u.last());D[n]&&u.last()==n&&i("",n),s=C[n]||!!s,s||u.push(n);var l={};a.replace(d,function(e,t,r,n,i){var a=r||n||i||"";l[t]=o(a)}),r.start&&r.start(n,l,s)}function i(e,n){var i,a=0;if(n=t.lowercase(n))for(a=u.length-1;a>=0&&u[a]!=n;a--);if(a>=0){for(i=u.length-1;i>=a;i--)r.end&&r.end(u[i]);u.length=a}}"string"!=typeof e&&(e=null===e||"undefined"==typeof e?"":""+e);var a,s,l,c,u=[],h=e;for(u.last=function(){return u[u.length-1]};e;){if(c="",s=!0,u.last()&&j[u.last()])e=e.replace(new RegExp("([^]*)<\\s*\\/\\s*"+u.last()+"[^>]*>","i"),function(e,t){return t=t.replace(x,"$1").replace(y,"$1"),r.chars&&r.chars(o(t)),""}),i("",u.last());else{if(z.test(e)){if(l=e.match(z)){l[0];r.whitespace&&r.whitespace(l[0]),e=e.replace(l[0],""),s=!1}}else k.test(e)?(l=e.match(k),l&&(r.comment&&r.comment(l[1]),e=e.replace(l[0],""),s=!1)):v.test(e)?(l=e.match(v),l&&(e=e.replace(l[0],""),s=!1)):b.test(e)?(l=e.match(g),l&&(e=e.substring(l[0].length),l[0].replace(g,i),s=!1)):m.test(e)&&(l=e.match(f),l?(l[4]&&(e=e.substring(l[0].length),l[0].replace(f,n)),s=!1):(c+="<",e=e.substring(1)));s&&(a=e.indexOf("<"),c+=0>a?e:e.substring(0,a),e=0>a?"":e.substring(a),r.chars&&r.chars(o(c)))}if(e==h)throw p("badparse","The sanitizer was unable to parse the following block of html: {0}",e);h=e}i()}function o(e){if(!e)return"";var t=G.exec(e),r=t[1],n=t[3],i=t[2];return i&&(B.innerHTML=i.replace(/</g,"&lt;"),i="textContent"in B?B.textContent:B.innerText),r+i+n}function l(e){return e.replace(/&/g,"&amp;").replace(w,function(e){var t=e.charCodeAt(0),r=e.charCodeAt(1);return"&#"+(1024*(t-55296)+(r-56320)+65536)+";"}).replace($,function(e){var t=e.charCodeAt(0);return 159>=t||173==t||t>=1536&&1540>=t||1807==t||6068==t||6069==t||t>=8204&&8207>=t||t>=8232&&8239>=t||t>=8288&&8303>=t||65279==t||t>=65520&&65535>=t?"&#"+t+";":e}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}function c(e){var r="",n=e.split(";");return t.forEach(n,function(e){var n=e.split(":");if(2==n.length){var i=H(t.lowercase(n[0])),e=H(t.lowercase(n[1]));(("color"===i||"background-color"===i)&&(e.match(/^rgb\([0-9%,\. ]*\)$/i)||e.match(/^rgba\([0-9%,\. ]*\)$/i)||e.match(/^hsl\([0-9%,\. ]*\)$/i)||e.match(/^hsla\([0-9%,\. ]*\)$/i)||e.match(/^#[0-9a-f]{3,6}$/i)||e.match(/^[a-z]*$/i))||"text-align"===i&&("left"===e||"right"===e||"center"===e||"justify"===e)||"text-decoration"===i&&("underline"===e||"line-through"===e)||"font-weight"===i&&"bold"===e||"float"===i&&("left"===e||"right"===e||"none"===e)||("width"===i||"height"===i)&&e.match(/[0-9\.]*(px|em|rem|%)/)||"direction"===i&&e.match(/^ltr|rtl|initial|inherit$/))&&(r+=i+": "+e+";")}}),r}function u(e,t,r,n){return!("img"!==e||!t["ta-insert-video"]||"ta-insert-video"!==r&&"allowfullscreen"!==r&&"frameborder"!==r&&("contenteditable"!==r||"false"!==n))}function h(e,r){var n=!1,i=t.bind(e,e.push);return{start:function(e,a,s){e=t.lowercase(e),!n&&j[e]&&(n=e),n||q[e]!==!0||(i("<"),i(e),t.forEach(a,function(n,s){var o=t.lowercase(s),h="img"===e&&"src"===o||"background"===o;("style"===o&&""!==(n=c(n))||u(e,a,o,n)||U[o]===!0&&(P[o]!==!0||r(n,h)))&&(i(" "),i(s),i('="'),i(l(n)),i('"'))}),i(s?"/>":">"))},comment:function(e){i(e)},whitespace:function(e){i(l(e))},end:function(e){e=t.lowercase(e),n||q[e]!==!0||(i("</"),i(e),i(">")),e==n&&(n=!1)},chars:function(e){n||i(l(e))}}}var p=t.$$minErr("$sanitize"),f=/^<((?:[a-zA-Z])[\w:-]*)((?:\s+[\w:-]+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)\s*(>?)/,g=/^<\/\s*([\w:-]+)[^>]*>/,d=/([\w:-]+)(?:\s*=\s*(?:(?:"((?:[^"])*)")|(?:'((?:[^'])*)')|([^>\s]+)))?/g,m=/^</,b=/^<\//,x=/<!--(.*?)-->/g,k=/(^<!--.*?-->)/,v=/<!DOCTYPE([^>]*?)>/i,y=/<!\[CDATA\[(.*?)]]>/g,w=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,$=/([^\#-~| |!])/g,z=/^(\s+)/,C=a("area,br,col,hr,img,wbr,input"),A=a("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),S=a("rp,rt"),D=t.extend({},S,A),T=t.extend({},A,a("address,article,aside,blockquote,caption,center,del,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,map,menu,nav,ol,pre,script,section,table,ul")),E=t.extend({},S,a("a,abbr,acronym,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,q,ruby,rp,rt,s,samp,small,span,strike,strong,sub,sup,time,tt,u,var")),F=a("animate,animateColor,animateMotion,animateTransform,circle,defs,desc,ellipse,font-face,font-face-name,font-face-src,g,glyph,hkern,image,linearGradient,line,marker,metadata,missing-glyph,mpath,path,polygon,polyline,radialGradient,rect,set,stop,svg,switch,text,title,tspan,use"),j=a("script,style"),q=t.extend({},C,T,E,D,F),P=a("background,cite,href,longdesc,src,usemap,xlink:href"),L=a("abbr,align,alt,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,coords,dir,face,headers,height,hreflang,hspace,id,ismap,lang,language,nohref,nowrap,rel,rev,rows,rowspan,rules,scope,scrolling,shape,size,span,start,summary,target,title,type,valign,value,vspace,width"),M=a("accent-height,accumulate,additive,alphabetic,arabic-form,ascent,attributeName,attributeType,baseProfile,bbox,begin,by,calcMode,cap-height,class,color,color-rendering,content,cx,cy,d,dx,dy,descent,display,dur,end,fill,fill-rule,font-family,font-size,font-stretch,font-style,font-variant,font-weight,from,fx,fy,g1,g2,glyph-name,gradientUnits,hanging,height,horiz-adv-x,horiz-origin-x,ideographic,k,keyPoints,keySplines,keyTimes,lang,marker-end,marker-mid,marker-start,markerHeight,markerUnits,markerWidth,mathematical,max,min,offset,opacity,orient,origin,overline-position,overline-thickness,panose-1,path,pathLength,points,preserveAspectRatio,r,refX,refY,repeatCount,repeatDur,requiredExtensions,requiredFeatures,restart,rotate,rx,ry,slope,stemh,stemv,stop-color,stop-opacity,strikethrough-position,strikethrough-thickness,stroke,stroke-dasharray,stroke-dashoffset,stroke-linecap,stroke-linejoin,stroke-miterlimit,stroke-opacity,stroke-width,systemLanguage,target,text-anchor,to,transform,type,u1,u2,underline-position,underline-thickness,unicode,unicode-range,units-per-em,values,version,viewBox,visibility,width,widths,x,x-height,x1,x2,xlink:actuate,xlink:arcrole,xlink:role,xlink:show,xlink:title,xlink:type,xml:base,xml:lang,xml:space,xmlns,xmlns:xlink,y,y1,y2,zoomAndPan"),U=t.extend({},P,M,L),B=document.createElement("pre"),G=/^(\s*)([\s\S]*?)(\s*)$/,H=function(){return String.prototype.trim?function(e){return t.isString(e)?e.trim():e}:function(e){return t.isString(e)?e.replace(/^\s\s*/,"").replace(/\s\s*$/,""):e}}();t.module("ngSanitize",[]).provider("$sanitize",n),t.module("ngSanitize").filter("linky",["$sanitize",function(e){var r=/((ftp|https?):\/\/|(www\.)|(mailto:)?[A-Za-z0-9._%+-]+@)\S*[^\s.;,(){}<>"”’]/,n=/^mailto:/;return function(a,s){function o(e){e&&f.push(i(e))}function l(e,r){f.push("<a "),t.isDefined(s)&&f.push('target="',s,'" '),f.push('href="',e.replace(/"/g,"&quot;"),'">'),o(r),f.push("</a>")}if(!a)return a;for(var c,u,h,p=a,f=[];c=p.match(r);)u=c[0],c[2]||c[4]||(u=(c[3]?"http://":"mailto:")+u),h=c.index,o(p.substr(0,h)),l(u,c[0].replace(n,"")),p=p.substring(h+c[0].length);return o(p),e(f.join(""))}}])}(window,window.angular);
var _browserDetect={ie:function(){for(var e,t=3,r=document.createElement("div"),n=r.getElementsByTagName("i");r.innerHTML="<!--[if gt IE "+ ++t+"]><i></i><![endif]-->",n[0];);return t>4?t:e}(),webkit:/AppleWebKit\/([\d.]+)/i.test(navigator.userAgent)},globalContentEditableBlur=!1;_browserDetect.webkit&&(document.addEventListener("mousedown",function(e){var t=e||window.event,r=t.target;if(globalContentEditableBlur&&null!==r){for(var n=!1,l=r;null!==l&&"html"!==l.tagName.toLowerCase()&&!n;)n="true"===l.contentEditable,l=l.parentNode;n||(document.getElementById("textAngular-editableFix-010203040506070809").setSelectionRange(0,0),r.focus(),r.select&&r.select())}globalContentEditableBlur=!1},!1),angular.element(document).ready(function(){angular.element(document.body).append(angular.element('<input id="textAngular-editableFix-010203040506070809" class="ta-hidden-input" aria-hidden="true" unselectable="on" tabIndex="-1">'))}));var BLOCKELEMENTS=/^(address|article|aside|audio|blockquote|canvas|dd|div|dl|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hgroup|hr|noscript|ol|output|p|pre|section|table|tfoot|ul|video)$/i,LISTELEMENTS=/^(ul|li|ol)$/i,VALIDELEMENTS=/^(address|article|aside|audio|blockquote|canvas|dd|div|dl|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hgroup|hr|noscript|ol|output|p|pre|section|table|tfoot|ul|video|li)$/i;String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var sheet,addCSSRule,removeCSSRule,_addCSSRule,_removeCSSRule,_getRuleIndex;if(_browserDetect.ie>8||void 0===_browserDetect.ie){for(var _sheets=document.styleSheets,i=0;i<_sheets.length;i++)if((0===_sheets[i].media.length||_sheets[i].media.mediaText.match(/(all|screen)/gi))&&_sheets[i].href&&_sheets[i].href.match(/textangular\.(min\.|)css/gi)){sheet=_sheets[i];break}sheet||(sheet=function(){var e=document.createElement("style");return _browserDetect.webkit&&e.appendChild(document.createTextNode("")),document.getElementsByTagName("head")[0].appendChild(e),e.sheet}()),addCSSRule=function(e,t){return _addCSSRule(sheet,e,t)},_addCSSRule=function(e,t,r){var n,l;return e.cssRules?n=Math.max(e.cssRules.length-1,0):e.rules&&(n=Math.max(e.rules.length-1,0)),e.insertRule?e.insertRule(t+"{"+r+"}",n):e.addRule(t,r,n),sheet.rules?l=sheet.rules[n]:sheet.cssRules&&(l=sheet.cssRules[n]),l},_getRuleIndex=function(e,t){var r,n;for(r=0;r<t.length;r++)if(t[r].cssText===e.cssText){n=r;break}return n},removeCSSRule=function(e){_removeCSSRule(sheet,e)},_removeCSSRule=function(e,t){var r=e.cssRules||e.rules;if(r&&0!==r.length){var n=_getRuleIndex(t,r);e.removeRule?e.removeRule(n):e.deleteRule(n)}}}
angular.module("textAngular.factories",[]).factory("taBrowserTag",[function(){return function(t){return t?""===t?void 0===_browserDetect.ie?"div":_browserDetect.ie<=8?"P":"p":_browserDetect.ie<=8?t.toUpperCase():t:_browserDetect.ie<=8?"P":"p"}}]).factory("taApplyCustomRenderers",["taCustomRenderers","taDOM",function(t,e){return function(r){var n=angular.element("<div></div>");return n[0].innerHTML=r,angular.forEach(t,function(t){var r=[];t.selector&&""!==t.selector?r=n.find(t.selector):t.customAttribute&&""!==t.customAttribute&&(r=e.getByAttribute(n,t.customAttribute)),angular.forEach(r,function(e){e=angular.element(e),t.selector&&""!==t.selector&&t.customAttribute&&""!==t.customAttribute?void 0!==e.attr(t.customAttribute)&&t.renderLogic(e):t.renderLogic(e)})}),n[0].innerHTML}}]).factory("taFixChrome",function(){var t=function(t){if(!t||!angular.isString(t)||t.length<=0)return t;for(var e,r,n,i=/<([^>\/]+?)style=("([^"]+)"|'([^']+)')([^>]*)>/gi,a="",o=0;e=i.exec(t);)r=e[3]||e[4],r&&r.match(/line-height: 1.[0-9]{3,12};|color: inherit; line-height: 1.1;/i)&&(r=r.replace(/( |)font-family: inherit;|( |)line-height: 1.[0-9]{3,12};|( |)color: inherit;/gi,""),n="<"+e[1].trim(),r.trim().length>0&&(n+=" style="+e[2].substring(0,1)+r+e[2].substring(0,1)),n+=e[5].trim()+">",a+=t.substring(o,e.index)+n,o=e.index+e[0].length);return a+=t.substring(o),o>0?a.replace(/<span\s?>(.*?)<\/span>(<br(\/|)>|)/gi,"$1"):t};return t}).factory("taSanitize",["$sanitize",function(t){function e(t,e){for(var r,n=0,i=0,a=/<[^>]*>/gi;r=a.exec(t);)if(i=r.index,"/"===r[0].substr(1,1)){if(0===n)break;n--}else n++;return e+t.substring(0,i)+angular.element(e)[0].outerHTML.substring(e.length)+t.substring(i)}function r(t){if(!t||!angular.isString(t)||t.length<=0)return t;for(var n,a,o,s,u,g,c=/<([^>\/]+?)style=("([^"]+)"|'([^']+)')([^>]*)>/gi,f="",h="",b=0;a=c.exec(t);){s=a[3]||a[4];var p=new RegExp(l,"i");if(angular.isString(s)&&p.test(s)){u="";for(var v=new RegExp(l,"ig");o=v.exec(s);)for(n=0;n<i.length;n++)o[2*n+2]&&(u+="<"+i[n].tag+">");g=r(t.substring(b,a.index)),h+=f.length>0?e(g,f):g,s=s.replace(new RegExp(l,"ig"),""),h+="<"+a[1].trim(),s.length>0&&(h+=' style="'+s+'"'),h+=a[5]+">",b=a.index+a[0].length,f=u}}return h+=f.length>0?e(t.substring(b),f):t.substring(b)}function n(t){if(!t||!angular.isString(t)||t.length<=0)return t;for(var e,r=/<([^>\/]+?)align=("([^"]+)"|'([^']+)')([^>]*)>/gi,n="",i=0;e=r.exec(t);){n+=t.substring(i,e.index),i=e.index+e[0].length;var a="<"+e[1]+e[5];/style=("([^"]+)"|'([^']+)')/gi.test(a)?a=a.replace(/style=("([^"]+)"|'([^']+)')/i,'style="$2$3 text-align:'+(e[3]||e[4])+';"'):a+=' style="text-align:'+(e[3]||e[4])+';"',a+=">",n+=a}return n+t.substring(i)}for(var i=[{property:"font-weight",values:["bold"],tag:"b"},{property:"font-style",values:["italic"],tag:"i"}],a=[],o=0;o<i.length;o++){for(var s="("+i[o].property+":\\s*(",u=0;u<i[o].values.length;u++)u>0&&(s+="|"),s+=i[o].values[u];s+=");)",a.push(s)}var l="("+a.join("|")+")";return function(e,i,a){if(!a)try{e=r(e)}catch(o){}e=n(e);var s;try{s=t(e),a&&(s=e)}catch(o){s=i||""}var u,l=s.match(/(<pre[^>]*>.*?<\/pre[^>]*>)/gi),g=s.replace(/(&#(9|10);)*/gi,""),c=/<pre[^>]*>.*?<\/pre[^>]*>/gi,f=0,h=0;for(s="";null!==(u=c.exec(g))&&f<l.length;)s+=g.substring(h,u.index)+l[f],h=u.index+u[0].length,f++;return s+g.substring(h)}}]).factory("taToolExecuteAction",["$q","$log",function(t,e){return function(r){void 0!==r&&(this.$editor=function(){return r});var n,i=t.defer(),a=i.promise,o=this.$editor();try{n=this.action(i,o.startAction()),a["finally"](function(){o.endAction.call(o)})}catch(s){e.error(s)}(n||void 0===n)&&i.resolve()}}]);
angular.module("textAngular.DOM",["textAngular.factories"]).factory("taExecCommand",["taSelection","taBrowserTag","$document",function(e,t,n){var r=function(t,n){var r,a,o=t.find("li");for(a=o.length-1;a>=0;a--)r=angular.element("<"+n+">"+o[a].innerHTML+"</"+n+">"),t.after(r);t.remove(),e.setSelectionToElementEnd(r[0])},a=function(t){/(<br(|\/)>)$/i.test(t.innerHTML.trim())?e.setSelectionBeforeElement(angular.element(t).find("br")[0]):e.setSelectionToElementEnd(t)},o=function(e,t){var n=angular.element("<"+t+">"+e[0].innerHTML+"</"+t+">");e.after(n),e.remove(),a(n.find("li")[0])},l=function(e,n,r){for(var o="",l=0;l<e.length;l++)o+="<"+t("li")+">"+e[l].innerHTML+"</"+t("li")+">";var i=angular.element("<"+r+">"+o+"</"+r+">");n.after(i),n.remove(),a(i.find("li")[0])};return function(a,i){return a=t(a),function(s,d,c,g){var f,m,u,N,h,p,C,L=angular.element("<"+a+">");try{C=e.getSelectionElement()}catch(E){}var v=angular.element(C);if(void 0!==C){var S=C.tagName.toLowerCase();if("insertorderedlist"===s.toLowerCase()||"insertunorderedlist"===s.toLowerCase()){var T=t("insertorderedlist"===s.toLowerCase()?"ol":"ul");if(S===T)return r(v,a);if("li"===S&&v.parent()[0].tagName.toLowerCase()===T&&1===v.parent().children().length)return r(v.parent(),a);if("li"===S&&v.parent()[0].tagName.toLowerCase()!==T&&1===v.parent().children().length)return o(v.parent(),T);if(S.match(BLOCKELEMENTS)&&!v.hasClass("ta-bind")){if("ol"===S||"ul"===S)return o(v,T);var M=!1;return angular.forEach(v.children(),function(e){e.tagName.match(BLOCKELEMENTS)&&(M=!0)}),M?l(v.children(),v,T):l([angular.element("<div>"+C.innerHTML+"</div>")[0]],v,T)}if(S.match(BLOCKELEMENTS)){if(N=e.getOnlySelectedElements(),0===N.length)m=angular.element("<"+T+"><li>"+C.innerHTML+"</li></"+T+">"),v.html(""),v.append(m);else{if(1===N.length&&("ol"===N[0].tagName.toLowerCase()||"ul"===N[0].tagName.toLowerCase()))return N[0].tagName.toLowerCase()===T?r(angular.element(N[0]),a):o(angular.element(N[0]),T);u="";var y=[];for(f=0;f<N.length;f++)if(3!==N[f].nodeType){var H=angular.element(N[f]);if("li"===N[f].tagName.toLowerCase())continue;u+="ol"===N[f].tagName.toLowerCase()||"ul"===N[f].tagName.toLowerCase()?H[0].innerHTML:"span"!==N[f].tagName.toLowerCase()||"ol"!==N[f].childNodes[0].tagName.toLowerCase()&&"ul"!==N[f].childNodes[0].tagName.toLowerCase()?"<"+t("li")+">"+H[0].innerHTML+"</"+t("li")+">":H[0].childNodes[0].innerHTML,y.unshift(H)}m=angular.element("<"+T+">"+u+"</"+T+">"),y.pop().replaceWith(m),angular.forEach(y,function(e){e.remove()})}return void e.setSelectionToElementEnd(m[0])}}else{if("formatblock"===s.toLowerCase()){for(p=c.toLowerCase().replace(/[<>]/gi,""),"default"===p.trim()&&(p=a,c="<"+a+">"),m="li"===S?v.parent():v;!m[0].tagName||!m[0].tagName.match(BLOCKELEMENTS)&&!m.parent().attr("contenteditable");)m=m.parent(),S=(m[0].tagName||"").toLowerCase();if(S===p){N=m.children();var w=!1;for(f=0;f<N.length;f++)w=w||N[f].tagName.match(BLOCKELEMENTS);w?(m.after(N),h=m.next(),m.remove(),m=h):(L.append(m[0].childNodes),m.after(L),m.remove(),m=L)}else if(m.parent()[0].tagName.toLowerCase()!==p||m.parent().hasClass("ta-bind"))if(S.match(LISTELEMENTS))m.wrap(c);else{for(N=e.getOnlySelectedElements(),0===N.length&&(N=[m[0]]),f=0;f<N.length;f++)if(3===N[f].nodeType||!N[f].tagName.match(BLOCKELEMENTS))for(;3===N[f].nodeType||!N[f].tagName||!N[f].tagName.match(BLOCKELEMENTS);)N[f]=N[f].parentNode;if(angular.element(N[0]).hasClass("ta-bind"))m=angular.element(c),m[0].innerHTML=N[0].innerHTML,N[0].innerHTML=m[0].outerHTML;else if("blockquote"===p){for(u="",f=0;f<N.length;f++)u+=N[f].outerHTML;for(m=angular.element(c),m[0].innerHTML=u,N[0].parentNode.insertBefore(m[0],N[0]),f=N.length-1;f>=0;f--)N[f].parentNode&&N[f].parentNode.removeChild(N[f])}else for(f=0;f<N.length;f++)m=angular.element(c),m[0].innerHTML=N[f].innerHTML,N[f].parentNode.insertBefore(m[0],N[f]),N[f].parentNode.removeChild(N[f])}else{var b=m.parent(),O=b.contents();for(f=0;f<O.length;f++)b.parent().hasClass("ta-bind")&&3===O[f].nodeType&&(L=angular.element("<"+a+">"),L[0].innerHTML=O[f].outerHTML,O[f]=L[0]),b.parent()[0].insertBefore(O[f],b[0]);b.remove()}return void e.setSelectionToElementEnd(m[0])}if("createlink"===s.toLowerCase()){var A='<a href="'+c+'" target="'+(g.a.target?g.a.target:"")+'">',B="</a>",R=e.getSelection();if(R.collapsed)e.insertHtml(A+c+B,i);else if(rangy.getSelection().getRangeAt(0).canSurroundContents()){var D=angular.element(A+B)[0];rangy.getSelection().getRangeAt(0).surroundContents(D)}return}if("inserthtml"===s.toLowerCase())return void e.insertHtml(c,i)}}try{n[0].execCommand(s,d,c)}catch(E){}}}}]).service("taSelection",["$document","taDOM",function(e,t){var n=e[0],r=function(e,t){return e.tagName&&e.tagName.match(/^br$/i)&&0===t&&!e.previousSibling?{element:e.parentNode,offset:0}:{element:e,offset:t}},a={getSelection:function(){var e=rangy.getSelection().getRangeAt(0),t=e.commonAncestorContainer,n={start:r(e.startContainer,e.startOffset),end:r(e.endContainer,e.endOffset),collapsed:e.collapsed};return t=3===t.nodeType?t.parentNode:t,t.parentNode===n.start.element||t.parentNode===n.end.element?n.container=t.parentNode:n.container=t,n},getOnlySelectedElements:function(){var e=rangy.getSelection().getRangeAt(0),t=e.commonAncestorContainer;return t=3===t.nodeType?t.parentNode:t,e.getNodes([1],function(e){return e.parentNode===t})},getSelectionElement:function(){return a.getSelection().container},setSelection:function(e,t,n){var r=rangy.createRange();r.setStart(e,t),r.setEnd(e,n),rangy.getSelection().setSingleRange(r)},setSelectionBeforeElement:function(e){var t=rangy.createRange();t.selectNode(e),t.collapse(!0),rangy.getSelection().setSingleRange(t)},setSelectionAfterElement:function(e){var t=rangy.createRange();t.selectNode(e),t.collapse(!1),rangy.getSelection().setSingleRange(t)},setSelectionToElementStart:function(e){var t=rangy.createRange();t.selectNodeContents(e),t.collapse(!0),rangy.getSelection().setSingleRange(t)},setSelectionToElementEnd:function(e){var t=rangy.createRange();t.selectNodeContents(e),t.collapse(!1),e.childNodes&&e.childNodes[e.childNodes.length-1]&&"br"===e.childNodes[e.childNodes.length-1].nodeName&&(t.startOffset=t.endOffset=t.startOffset-1),rangy.getSelection().setSingleRange(t)},insertHtml:function(e,r){var o,l,i,s,d,c,g,f=angular.element("<div>"+e+"</div>"),m=rangy.getSelection().getRangeAt(0),u=n.createDocumentFragment(),N=f[0].childNodes,h=!0;if(N.length>0){for(s=[],i=0;i<N.length;i++)"p"===N[i].nodeName.toLowerCase()&&""===N[i].innerHTML.trim()||3===N[i].nodeType&&""===N[i].nodeValue.trim()||(h=h&&!BLOCKELEMENTS.test(N[i].nodeName),s.push(N[i]));for(var p=0;p<s.length;p++)c=u.appendChild(s[p]);!h&&m.collapsed&&/^(|<br(|\/)>)$/i.test(m.startContainer.innerHTML)&&m.selectNode(m.startContainer)}else h=!0,c=u=n.createTextNode(e);if(h)m.deleteContents();else if(m.collapsed&&m.startContainer!==r)if(m.startContainer.innerHTML&&m.startContainer.innerHTML.match(/^<[^>]*>$/i))o=m.startContainer,1===m.startOffset?(m.setStartAfter(o),m.setEndAfter(o)):(m.setStartBefore(o),m.setEndBefore(o));else{if(3===m.startContainer.nodeType&&m.startContainer.parentNode!==r)for(o=m.startContainer.parentNode,l=o.cloneNode(),t.splitNodes(o.childNodes,o,l,m.startContainer,m.startOffset);!VALIDELEMENTS.test(o.nodeName);){angular.element(o).after(l),o=o.parentNode;var C=l;l=o.cloneNode(),t.splitNodes(o.childNodes,o,l,C)}else o=m.startContainer,l=o.cloneNode(),t.splitNodes(o.childNodes,o,l,void 0,void 0,m.startOffset);if(angular.element(o).after(l),m.setStartAfter(o),m.setEndAfter(o),/^(|<br(|\/)>)$/i.test(o.innerHTML.trim())&&(m.setStartBefore(o),m.setEndBefore(o),angular.element(o).remove()),/^(|<br(|\/)>)$/i.test(l.innerHTML.trim())&&angular.element(l).remove(),"li"===o.nodeName.toLowerCase()){for(g=n.createDocumentFragment(),d=0;d<u.childNodes.length;d++)f=angular.element("<li>"),t.transferChildNodes(u.childNodes[d],f[0]),t.transferNodeAttributes(u.childNodes[d],f[0]),g.appendChild(f[0]);u=g,c&&(c=u.childNodes[u.childNodes.length-1],c=c.childNodes[c.childNodes.length-1])}}else m.deleteContents();m.insertNode(u),c&&a.setSelectionToElementEnd(c)}};return a}]).service("taDOM",function(){var e={getByAttribute:function(t,n){var r=[],a=t.children();return a.length&&angular.forEach(a,function(t){r=r.concat(e.getByAttribute(angular.element(t),n))}),void 0!==t.attr(n)&&r.push(t),r},transferChildNodes:function(e,t){for(t.innerHTML="";e.childNodes.length>0;)t.appendChild(e.childNodes[0]);return t},splitNodes:function(t,n,r,a,o,l){if(!a&&isNaN(l))throw new Error("taDOM.splitNodes requires a splitNode or splitIndex");for(var i=document.createDocumentFragment(),s=document.createDocumentFragment(),d=0;t.length>0&&(isNaN(l)||l!==d)&&t[0]!==a;)i.appendChild(t[0]),d++;for(!isNaN(o)&&o>=0&&t[0]&&(i.appendChild(document.createTextNode(t[0].nodeValue.substring(0,o))),t[0].nodeValue=t[0].nodeValue.substring(o));t.length>0;)s.appendChild(t[0]);e.transferChildNodes(i,n),e.transferChildNodes(s,r)},transferNodeAttributes:function(e,t){for(var n=0;n<e.attributes.length;n++)t.setAttribute(e.attributes[n].name,e.attributes[n].value);return t}};return e});
angular.module("textAngular.validators",[]).directive("taMaxText",function(){return{restrict:"A",require:"ngModel",link:function(t,e,n,a){var i=parseInt(t.$eval(n.taMaxText));if(isNaN(i))throw"Max text must be an integer";n.$observe("taMaxText",function(t){if(i=parseInt(t),isNaN(i))throw"Max text must be an integer";a.$dirty&&a.$validate()}),a.$validators.taMaxText=function(t){var e=angular.element("<div/>");return e.html(t),e.text().length<=i}}}}).directive("taMinText",function(){return{restrict:"A",require:"ngModel",link:function(t,e,n,a){var i=parseInt(t.$eval(n.taMinText));if(isNaN(i))throw"Min text must be an integer";n.$observe("taMinText",function(t){if(i=parseInt(t),isNaN(i))throw"Min text must be an integer";a.$dirty&&a.$validate()}),a.$validators.taMinText=function(t){var e=angular.element("<div/>");return e.html(t),!e.text().length||e.text().length>=i}}}});
angular.module("textAngular.taBind",["textAngular.factories","textAngular.DOM"]).service("_taBlankTest",[function(){var e=/<(a|abbr|acronym|bdi|bdo|big|cite|code|del|dfn|img|ins|kbd|label|map|mark|q|ruby|rp|rt|s|samp|time|tt|var)[^>]*(>|$)/i;return function(t){return function(n){if(!n)return!0;var a,r=/(^[^<]|>)[^<]/i.exec(n);return r?a=r.index:(n=n.toString().replace(/="[^"]*"/i,"").replace(/="[^"]*"/i,"").replace(/="[^"]*"/i,"").replace(/="[^"]*"/i,""),a=n.indexOf(">")),n=n.trim().substring(a,a+100),/^[^<>]+$/i.test(n)?!1:0===n.length||n===t||/^>(\s|&nbsp;)*<\/[^>]+>$/gi.test(n)?!0:!/>\s*[^\s<]/i.test(n)&&!e.test(n)}}}]).directive("taButton",[function(){return{link:function(e,t,n){t.attr("unselectable","on"),t.on("mousedown",function(e,t){return t&&angular.extend(e,t),e.preventDefault(),!1})}}}]).directive("taBind",["taSanitize","$timeout","$document","taFixChrome","taBrowserTag","taSelection","taSelectableElements","taApplyCustomRenderers","taOptions","_taBlankTest","$parse","taDOM","textAngularManager",function(e,t,n,a,r,i,o,l,s,d,u,c,f){return{priority:2,require:["ngModel","?ngModelOptions"],link:function(r,p,m,v){function h(e){var t;return H.forEach(function(n){if(n.keyCode===e.keyCode){var a=(e.metaKey?K:0)+(e.ctrlKey?T:0)+(e.shiftKey?W:0)+(e.altKey?_:0);if(n.forbiddenModifiers&a)return;n.mustHaveModifiers.every(function(e){return a&e})&&(t=n.specialKey)}}),t}var g,b,y,C,L=v[0],w=v[1]||{},x=void 0!==p.attr("contenteditable")&&p.attr("contenteditable"),D=x||"textarea"===p[0].tagName.toLowerCase()||"input"===p[0].tagName.toLowerCase(),N=!1,k=!1,M=!1,$=m.taUnsafeSanitizer||s.disableSanitizer,S=/^(9|19|20|27|33|34|35|36|37|38|39|40|45|112|113|114|115|116|117|118|119|120|121|122|123|144|145)$/i,E=/^(8|13|32|46|59|61|107|109|173|186|187|188|189|190|191|192|219|220|221|222)$/i,T=1,K=2,_=4,W=8,H=[{specialKey:"UndoKey",forbiddenModifiers:_+W,mustHaveModifiers:[K+T],keyCode:90},{specialKey:"RedoKey",forbiddenModifiers:_,mustHaveModifiers:[K+T,W],keyCode:90},{specialKey:"RedoKey",forbiddenModifiers:_+W,mustHaveModifiers:[K+T],keyCode:89},{specialKey:"TabKey",forbiddenModifiers:K+W+_+T,mustHaveModifiers:[],keyCode:9},{specialKey:"ShiftTabKey",forbiddenModifiers:K+_+T,mustHaveModifiers:[W],keyCode:9}];void 0===m.taDefaultWrap&&(m.taDefaultWrap="p"),""===m.taDefaultWrap?(y="",C=void 0===_browserDetect.ie?"<div><br></div>":_browserDetect.ie>=11?"<p><br></p>":_browserDetect.ie<=8?"<P>&nbsp;</P>":"<p>&nbsp;</p>"):(y=void 0===_browserDetect.ie||_browserDetect.ie>=11?"<"+m.taDefaultWrap+"><br></"+m.taDefaultWrap+">":_browserDetect.ie<=8?"<"+m.taDefaultWrap.toUpperCase()+"></"+m.taDefaultWrap.toUpperCase()+">":"<"+m.taDefaultWrap+"></"+m.taDefaultWrap+">",C=void 0===_browserDetect.ie||_browserDetect.ie>=11?"<"+m.taDefaultWrap+"><br></"+m.taDefaultWrap+">":_browserDetect.ie<=8?"<"+m.taDefaultWrap.toUpperCase()+">&nbsp;</"+m.taDefaultWrap.toUpperCase()+">":"<"+m.taDefaultWrap+">&nbsp;</"+m.taDefaultWrap+">"),w.$options||(w.$options={});var I=d(C),A=function(e){if(I(e))return e;var t=angular.element("<div>"+e+"</div>");if(0===t.children().length)e="<"+m.taDefaultWrap+">"+e+"</"+m.taDefaultWrap+">";else{var n,a=t[0].childNodes,r=!1;for(n=0;n<a.length&&!(r=a[n].nodeName.toLowerCase().match(BLOCKELEMENTS));n++);if(r)for(e="",n=0;n<a.length;n++){var i=a[n],o=i.nodeName.toLowerCase();if("#comment"===o)e+="<!--"+i.nodeValue+"-->";else if("#text"===o){var l=i.textContent;e+=l.trim()?"<"+m.taDefaultWrap+">"+l+"</"+m.taDefaultWrap+">":l}else if(o.match(BLOCKELEMENTS))e+=i.outerHTML;else{var s=i.outerHTML||i.nodeValue;e+=""!==s.trim()?"<"+m.taDefaultWrap+">"+s+"</"+m.taDefaultWrap+">":s}}else e="<"+m.taDefaultWrap+">"+e+"</"+m.taDefaultWrap+">"}return e};m.taPaste&&(b=u(m.taPaste)),p.addClass("ta-bind");var V;r["$undoManager"+(m.id||"")]=L.$undoManager={_stack:[],_index:0,_max:1e3,push:function(e){return"undefined"==typeof e||null===e||"undefined"!=typeof this.current()&&null!==this.current()&&e===this.current()?e:(this._index<this._stack.length-1&&(this._stack=this._stack.slice(0,this._index+1)),this._stack.push(e),V&&t.cancel(V),this._stack.length>this._max&&this._stack.shift(),this._index=this._stack.length-1,e)},undo:function(){return this.setToIndex(this._index-1)},redo:function(){return this.setToIndex(this._index+1)},setToIndex:function(e){return 0>e||e>this._stack.length-1?void 0:(this._index=e,this.current())},current:function(){return this._stack[this._index]}};var B,U=r["$undoTaBind"+(m.id||"")]=function(){if(!N&&x){var e=L.$undoManager.undo();"undefined"!=typeof e&&null!==e&&(ne(e),R(e,!1),B&&t.cancel(B),B=t(function(){p[0].focus(),i.setSelectionToElementEnd(p[0])},1))}},O=r["$redoTaBind"+(m.id||"")]=function(){if(!N&&x){var e=L.$undoManager.redo();"undefined"!=typeof e&&null!==e&&(ne(e),R(e,!1),B&&t.cancel(B),B=t(function(){p[0].focus(),i.setSelectionToElementEnd(p[0])},1))}},F=function(){if(x)return p[0].innerHTML;if(D)return p.val();throw"textAngular Error: attempting to update non-editable taBind"},R=function(e,t,n){M=n||!1,"undefined"!=typeof t&&null!==t||(t=x),"undefined"!=typeof e&&null!==e||(e=F()),I(e)?(""!==L.$viewValue&&L.$setViewValue(""),t&&""!==L.$undoManager.current()&&L.$undoManager.push("")):(te(),L.$viewValue!==e&&(L.$setViewValue(e),t&&L.$undoManager.push(e))),L.$render()};r["updateTaBind"+(m.id||"")]=function(){N||R(void 0,void 0,!0)};var z=function(t){return L.$oldViewValue=e(a(t),L.$oldViewValue,$)};if(p.attr("required")&&(L.$validators.required=function(e,t){return!I(e||t)}),L.$parsers.push(z),L.$parsers.unshift(A),L.$formatters.push(z),L.$formatters.unshift(A),L.$formatters.unshift(function(e){return L.$undoManager.push(e||"")}),D)if(r.events={},x){var P=!1,q=function(n){var a=n.match(/content=["']*OneNote.File/i);if(n&&n.trim().length){if(n.match(/class=["']*Mso(Normal|List)/i)||n.match(/content=["']*Word.Document/i)||n.match(/content=["']*OneNote.File/i)){var o=n.match(/<!--StartFragment-->([\s\S]*?)<!--EndFragment-->/i);o=o?o[1]:n,o=o.replace(/<o:p>[\s\S]*?<\/o:p>/gi,"").replace(/class=(["']|)MsoNormal(["']|)/gi,"");var l=angular.element("<div>"+o+"</div>"),s=angular.element("<div></div>"),d={element:null,lastIndent:[],lastLi:null,isUl:!1};d.lastIndent.peek=function(){var e=this.length;return e>0?this[e-1]:void 0};for(var u=function(e){d.isUl=e,d.element=angular.element(e?"<ul>":"<ol>"),d.lastIndent=[],d.lastIndent.peek=function(){var e=this.length;return e>0?this[e-1]:void 0},d.lastLevelMatch=null},f=0;f<=l[0].childNodes.length;f++)if(l[0].childNodes[f]&&"#text"!==l[0].childNodes[f].nodeName){var m=l[0].childNodes[f].tagName.toLowerCase();if("p"===m||"h1"===m||"h2"===m||"h3"===m||"h4"===m||"h5"===m||"h6"===m){var v=angular.element(l[0].childNodes[f]),h=(v.attr("class")||"").match(/MsoList(Bullet|Number|Paragraph)(CxSp(First|Middle|Last)|)/i);if(h){if(v[0].childNodes.length<2||v[0].childNodes[1].childNodes.length<1)continue;var g="bullet"===h[1].toLowerCase()||"number"!==h[1].toLowerCase()&&!(/^[^0-9a-z<]*[0-9a-z]+[^0-9a-z<>]</i.test(v[0].childNodes[1].innerHTML)||/^[^0-9a-z<]*[0-9a-z]+[^0-9a-z<>]</i.test(v[0].childNodes[1].childNodes[0].innerHTML)),y=(v.attr("style")||"").match(/margin-left:([\-\.0-9]*)/i),C=parseFloat(y?y[1]:0),w=(v.attr("style")||"").match(/mso-list:l([0-9]+) level([0-9]+) lfo[0-9+]($|;)/i);if(w&&w[2]&&(C=parseInt(w[2])),w&&(!d.lastLevelMatch||w[1]!==d.lastLevelMatch[1])||!h[3]||"first"===h[3].toLowerCase()||null===d.lastIndent.peek()||d.isUl!==g&&d.lastIndent.peek()===C)u(g),s.append(d.element);else if(null!=d.lastIndent.peek()&&d.lastIndent.peek()<C)d.element=angular.element(g?"<ul>":"<ol>"),d.lastLi.append(d.element);else if(null!=d.lastIndent.peek()&&d.lastIndent.peek()>C){for(;null!=d.lastIndent.peek()&&d.lastIndent.peek()>C;)if("li"!==d.element.parent()[0].tagName.toLowerCase()){if(!/[uo]l/i.test(d.element.parent()[0].tagName.toLowerCase()))break;d.element=d.element.parent(),d.lastIndent.pop()}else d.element=d.element.parent();d.isUl="ul"===d.element[0].tagName.toLowerCase(),g!==d.isUl&&(u(g),s.append(d.element))}d.lastLevelMatch=w,C!==d.lastIndent.peek()&&d.lastIndent.push(C),d.lastLi=angular.element("<li>"),d.element.append(d.lastLi),d.lastLi.html(v.html().replace(/<!(--|)\[if !supportLists\](--|)>[\s\S]*?<!(--|)\[endif\](--|)>/gi,"")),v.remove()}else u(!1),s.append(v)}}var x=function(e){e=angular.element(e);for(var t=e[0].childNodes.length-1;t>=0;t--)e.after(e[0].childNodes[t]);e.remove()};angular.forEach(s.find("span"),function(e){e.removeAttribute("lang"),e.attributes.length<=0&&x(e)}),angular.forEach(s.find("font"),x),n=s.html(),a&&(n=s.html()||l.html())}else{if(n=n.replace(/<(|\/)meta[^>]*?>/gi,""),n.match(/<[^>]*?(ta-bind)[^>]*?>/)){if(n.match(/<[^>]*?(text-angular)[^>]*?>/)){var D=angular.element("<div>"+n+"</div>");D.find("textarea").remove();for(var N=c.getByAttribute(D,"ta-bind"),k=0;k<N.length;k++){for(var M=N[k][0].parentNode.parentNode,S=0;S<N[k][0].childNodes.length;S++)M.parentNode.insertBefore(N[k][0].childNodes[S],M);M.parentNode.removeChild(M)}n=D.html().replace('<br class="Apple-interchange-newline">',"")}}else n.match(/^<span/)&&(n.match(/<span class=(\"Apple-converted-space\"|\'Apple-converted-space\')>.<\/span>/gi)||(n=n.replace(/<(|\/)span[^>]*?>/gi,"")));n=n.replace(/<br class="Apple-interchange-newline"[^>]*?>/gi,"").replace(/<span class="Apple-converted-space">( |&nbsp;)<\/span>/gi,"&nbsp;")}/<li(\s.*)?>/i.test(n)&&/(<ul(\s.*)?>|<ol(\s.*)?>).*<li(\s.*)?>/i.test(n)===!1&&(n=n.replace(/<li(\s.*)?>.*<\/li(\s.*)?>/i,"<ul>$&</ul>")),n=n.replace(/^[ |\u00A0]+/gm,function(e){for(var t="",n=0;n<e.length;n++)t+="&nbsp;";return t}).replace(/\n|\r\n|\r/g,"<br />").replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;"),b&&(n=b(r,{$html:n})||n),n=e(n,"",$),i.insertHtml(n,p[0]),t(function(){L.$setViewValue(F()),P=!1,p.removeClass("processing-paste")},0)}else P=!1,p.removeClass("processing-paste")};p.on("paste",r.events.paste=function(e,a){if(a&&angular.extend(e,a),N||P)return e.stopPropagation(),e.preventDefault(),!1;P=!0,p.addClass("processing-paste");var r,i=(e.originalEvent||e).clipboardData;if(i&&i.getData&&i.types.length>0){for(var o="",l=0;l<i.types.length;l++)o+=" "+i.types[l];return/text\/html/i.test(o)?r=i.getData("text/html"):/text\/plain/i.test(o)&&(r=i.getData("text/plain")),q(r),e.stopPropagation(),e.preventDefault(),!1}var s=rangy.saveSelection(),d=angular.element('<div class="ta-hidden-input" contenteditable="true"></div>');n.find("body").append(d),d[0].focus(),t(function(){rangy.restoreSelection(s),q(d[0].innerHTML),p[0].focus(),d.remove()},0)}),p.on("cut",r.events.cut=function(e){N?e.preventDefault():t(function(){L.$setViewValue(F())},0)}),p.on("keydown",r.events.keydown=function(e,t){t&&angular.extend(e,t),e.specialKey=h(e);var n;if(s.keyMappings.forEach(function(t){e.specialKey===t.commandKeyCode&&(e.specialKey=void 0),t.testForKey(e)&&(n=t.commandKeyCode),"UndoKey"!==t.commandKeyCode&&"RedoKey"!==t.commandKeyCode||t.enablePropagation||e.preventDefault()}),"undefined"!=typeof n&&(e.specialKey=n),"undefined"==typeof e.specialKey||"UndoKey"===e.specialKey&&"RedoKey"===e.specialKey||(e.preventDefault(),f.sendKeyCommand(r,e)),!N&&("UndoKey"===e.specialKey&&(U(),e.preventDefault()),"RedoKey"===e.specialKey&&(O(),e.preventDefault()),13===e.keyCode&&!e.shiftKey)){var a,o=function(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return!0;return!1},l=i.getSelectionElement();if(!l.tagName.match(VALIDELEMENTS))return;var d=angular.element(y),u=["blockquote","ul","ol"];if(o(u,l.parentNode.tagName.toLowerCase())){if(/^<br(|\/)>$/i.test(l.innerHTML.trim())&&!l.nextSibling){a=angular.element(l);var c=a.parent();c.after(d),a.remove(),0===c.children().length&&c.remove(),i.setSelectionToElementStart(d[0]),e.preventDefault()}/^<[^>]+><br(|\/)><\/[^>]+>$/i.test(l.innerHTML.trim())&&(a=angular.element(l),a.after(d),a.remove(),i.setSelectionToElementStart(d[0]),e.preventDefault())}}});var j;if(p.on("keyup",r.events.keyup=function(e,n){if(n&&angular.extend(e,n),9===e.keyCode){var a=i.getSelection();return void(a.start.element===p[0]&&p.children().length&&i.setSelectionToElementStart(p.children()[0]))}if(V&&t.cancel(V),!N&&!S.test(e.keyCode)){if(""!==y&&13===e.keyCode&&!e.shiftKey){for(var r=i.getSelectionElement();!r.tagName.match(VALIDELEMENTS)&&r!==p[0];)r=r.parentNode;if(r.tagName.toLowerCase()!==m.taDefaultWrap&&"li"!==r.tagName.toLowerCase()&&(""===r.innerHTML.trim()||"<br>"===r.innerHTML.trim())){var o=angular.element(y);angular.element(r).replaceWith(o),i.setSelectionToElementStart(o[0])}}var l=F();""!==y&&""===l.trim()?(ne(y),i.setSelectionToElementStart(p.children()[0])):"<"!==l.substring(0,1)&&""!==m.taDefaultWrap;var s=g!==e.keyCode&&E.test(e.keyCode);j&&t.cancel(j),j=t(function(){R(l,s,!0)},w.$options.debounce||400),s||(V=t(function(){L.$undoManager.push(l)},250)),g=e.keyCode}}),p.on("blur",r.events.blur=function(){k=!1,N?(M=!0,L.$render()):R(void 0,void 0,!0)}),m.placeholder&&(_browserDetect.ie>8||void 0===_browserDetect.ie)){var G;if(!m.id)throw"textAngular Error: An unique ID is required for placeholders to work";G=addCSSRule("#"+m.id+".placeholder-text:before",'content: "'+m.placeholder+'"'),r.$on("$destroy",function(){removeCSSRule(G)})}p.on("focus",r.events.focus=function(){k=!0,p.removeClass("placeholder-text"),te()}),p.on("mouseup",r.events.mouseup=function(){var e=i.getSelection();e.start.element===p[0]&&p.children().length&&i.setSelectionToElementStart(p.children()[0])}),p.on("mousedown",r.events.mousedown=function(e,t){t&&angular.extend(e,t),e.stopPropagation()})}else{p.on("change blur",r.events.change=r.events.blur=function(){N||L.$setViewValue(F())}),p.on("keydown",r.events.keydown=function(e,t){if(t&&angular.extend(e,t),9===e.keyCode){var n=this.selectionStart,a=this.selectionEnd,r=p.val();if(e.shiftKey){var i=r.lastIndexOf("\n",n),o=r.lastIndexOf("	",n);-1!==o&&o>=i&&(p.val(r.substring(0,o)+r.substring(o+1)),this.selectionStart=this.selectionEnd=n-1)}else p.val(r.substring(0,n)+"	"+r.substring(a)),this.selectionStart=this.selectionEnd=n+1;e.preventDefault()}});var J=function(e,t){for(var n="",a=0;t>a;a++)n+=e;return n},Q=function(e,t,n){for(var a=0;a<e.length;a++)t.call(n,a,e[a])},X=function(e,t){var n="",a=e.childNodes;return t++,n+=J("	",t-1)+e.outerHTML.substring(0,4),Q(a,function(e,a){var r=a.nodeName.toLowerCase();return"#comment"===r?void(n+="<!--"+a.nodeValue+"-->"):"#text"===r?void(n+=a.textContent):void(a.outerHTML&&(n+="ul"===r||"ol"===r?"\n"+X(a,t):"\n"+J("	",t)+a.outerHTML))}),n+="\n"+J("	",t-1)+e.outerHTML.substring(e.outerHTML.lastIndexOf("<"))};L.$formatters.unshift(function(e){var t=angular.element("<div>"+e+"</div>")[0].childNodes;return t.length>0&&(e="",Q(t,function(t,n){var a=n.nodeName.toLowerCase();return"#comment"===a?void(e+="<!--"+n.nodeValue+"-->"):"#text"===a?void(e+=n.textContent):void(n.outerHTML&&(e.length>0&&(e+="\n"),e+="ul"===a||"ol"===a?""+X(n,0):""+n.outerHTML))})),e})}var Y,Z=function(e){return r.$emit("ta-element-select",this),e.preventDefault(),!1},ee=function(e,n){if(n&&angular.extend(e,n),!dropFired&&!N){dropFired=!0;var a;a=e.originalEvent?e.originalEvent.dataTransfer:e.dataTransfer,r.$emit("ta-drop-event",this,e,a),t(function(){dropFired=!1,R(void 0,void 0,!0)},100)}},te=r["reApplyOnSelectorHandlers"+(m.id||"")]=function(){N||angular.forEach(o,function(e){p.find(e).off("click",Z).on("click",Z)})},ne=function(e){p[0].innerHTML=e},ae=!1;L.$render=function(){if(!ae){ae=!0;var e=L.$viewValue||"";M||(x&&k&&(p.removeClass("placeholder-text"),Y&&t.cancel(Y),Y=t(function(){k||(p[0].focus(),i.setSelectionToElementEnd(p.children()[p.children().length-1])),Y=void 0},1)),x?(ne(m.placeholder?""===e?y:e:""===e?y:e),N?p.off("drop",ee):(te(),p.on("drop",ee))):"textarea"!==p[0].tagName.toLowerCase()&&"input"!==p[0].tagName.toLowerCase()?ne(l(e)):p.val(e)),x&&m.placeholder&&(""===e?k?p.removeClass("placeholder-text"):p.addClass("placeholder-text"):p.removeClass("placeholder-text")),ae=M=!1}},m.taReadonly&&(N=r.$eval(m.taReadonly),N?(p.addClass("ta-readonly"),"textarea"!==p[0].tagName.toLowerCase()&&"input"!==p[0].tagName.toLowerCase()||p.attr("disabled","disabled"),void 0!==p.attr("contenteditable")&&p.attr("contenteditable")&&p.removeAttr("contenteditable")):(p.removeClass("ta-readonly"),"textarea"===p[0].tagName.toLowerCase()||"input"===p[0].tagName.toLowerCase()?p.removeAttr("disabled"):x&&p.attr("contenteditable","true")),r.$watch(m.taReadonly,function(e,t){t!==e&&(e?(p.addClass("ta-readonly"),"textarea"!==p[0].tagName.toLowerCase()&&"input"!==p[0].tagName.toLowerCase()||p.attr("disabled","disabled"),void 0!==p.attr("contenteditable")&&p.attr("contenteditable")&&p.removeAttr("contenteditable"),angular.forEach(o,function(e){p.find(e).on("click",Z)}),p.off("drop",ee)):(p.removeClass("ta-readonly"),"textarea"===p[0].tagName.toLowerCase()||"input"===p[0].tagName.toLowerCase()?p.removeAttr("disabled"):x&&p.attr("contenteditable","true"),angular.forEach(o,function(e){p.find(e).off("click",Z)}),p.on("drop",ee)),N=e)})),x&&!N&&(angular.forEach(o,function(e){p.find(e).on("click",Z)}),p.on("drop",ee),p.on("blur",function(){_browserDetect.webkit&&(globalContentEditableBlur=!0)}))}}}]);
function validElementString(t){try{return 0!==angular.element(t).length}catch(e){return!1}}function registerTextAngularTool(t,e){if(!t||""===t||taTools.hasOwnProperty(t))throw"textAngular Error: A unique name is required for a Tool Definition";if(e.display&&(""===e.display||!validElementString(e.display))||!e.display&&!e.buttontext&&!e.iconclass)throw'textAngular Error: Tool Definition for "'+t+'" does not have a valid display/iconclass/buttontext value';taTools[t]=e}var taTools={};angular.module("textAngularSetup",[]).constant("taRegisterTool",registerTextAngularTool).value("taTools",taTools).value("taOptions",{forceTextAngularSanitize:!0,keyMappings:[],toolbar:[["h1","h2","h3","h4","h5","h6","p","pre","quote"],["bold","italics","underline","strikeThrough","ul","ol","redo","undo","clear"],["justifyLeft","justifyCenter","justifyRight","justifyFull","indent","outdent"],["html","insertImage","insertLink","insertVideo","wordcount","charcount"]],classes:{focussed:"focussed",toolbar:"btn-toolbar",toolbarGroup:"btn-group",toolbarButton:"md-fab md-mini",toolbarButtonActive:"active",disabled:"disabled",textEditor:"form-control",htmlEditor:"form-control"},defaultTagAttributes:{a:{target:""}},setup:{textEditorSetup:function(t){},htmlEditorSetup:function(t){}},defaultFileDropHandler:function(t,e){var n=new FileReader;return"image"===t.type.substring(0,5)?(n.onload=function(){""!==n.result&&e("insertImage",n.result,!0)},n.readAsDataURL(t),!0):!1}}).value("taSelectableElements",["a","img"]).value("taCustomRenderers",[{selector:"img",customAttribute:"ta-insert-video",renderLogic:function(t){var e=angular.element("<iframe></iframe>"),n=t.prop("attributes");angular.forEach(n,function(t){e.attr(t.name,t.value)}),e.attr("src",e.attr("ta-insert-video")),t.replaceWith(e)}}]).value("taTranslations",{html:{tooltip:"Toggle html / Rich Text"},heading:{tooltip:"Heading "},p:{tooltip:"Paragraph"},pre:{tooltip:"Preformatted text"},ul:{tooltip:"Unordered List"},ol:{tooltip:"Ordered List"},quote:{tooltip:"Quote/unquote selection or paragraph"},undo:{tooltip:"Undo"},redo:{tooltip:"Redo"},bold:{tooltip:"Bold"},italic:{tooltip:"Italic"},underline:{tooltip:"Underline"},strikeThrough:{tooltip:"Strikethrough"},justifyLeft:{tooltip:"Align text left"},justifyRight:{tooltip:"Align text right"},justifyFull:{tooltip:"Justify text"},justifyCenter:{tooltip:"Center"},indent:{tooltip:"Increase indent"},outdent:{tooltip:"Decrease indent"},clear:{tooltip:"Clear formatting"},insertImage:{dialogPrompt:"Please enter an image URL to insert",tooltip:"Insert image",hotkey:"the - possibly language dependent hotkey ... for some future implementation"},insertVideo:{tooltip:"Insert video",dialogPrompt:"Please enter a youtube URL to embed"},insertLink:{tooltip:"Insert / edit link",dialogPrompt:"Please enter a URL to insert"},editLink:{reLinkButton:{tooltip:"Relink"},unLinkButton:{tooltip:"Unlink"},targetToggle:{buttontext:"Open in New Window"}},wordcount:{tooltip:"Display words Count"},charcount:{tooltip:"Display characters Count"}}).factory("taToolFunctions",["$window","taTranslations",function(t,e){return{imgOnSelectAction:function(t,e,n){var o=function(){n.updateTaBindtaTextElement(),n.hidePopover()};t.preventDefault(),n.displayElements.popover.css("width","375px");var i=n.displayElements.popoverContainer;i.empty();var a=angular.element('<div class="btn-group" style="padding-right: 6px;">'),l=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">100% </button>');l.on("click",function(t){t.preventDefault(),e.css({width:"100%",height:""}),o()});var r=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">50% </button>');r.on("click",function(t){t.preventDefault(),e.css({width:"50%",height:""}),o()});var u=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">25% </button>');u.on("click",function(t){t.preventDefault(),e.css({width:"25%",height:""}),o()});var s=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">Reset</button>');s.on("click",function(t){t.preventDefault(),e.css({width:"",height:""}),o()}),a.append(l),a.append(r),a.append(u),a.append(s),i.append(a),a=angular.element('<div class="btn-group" style="padding-right: 6px;">');var c=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-align-left"></i></button>');c.on("click",function(t){t.preventDefault(),e.css("float","left"),e.css("cssFloat","left"),e.css("styleFloat","left"),o()});var d=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-align-right"></i></button>');d.on("click",function(t){t.preventDefault(),e.css("float","right"),e.css("cssFloat","right"),e.css("styleFloat","right"),o()});var p=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-align-justify"></i></button>');p.on("click",function(t){t.preventDefault(),e.css("float",""),e.css("cssFloat",""),e.css("styleFloat",""),o()}),a.append(c),a.append(p),a.append(d),i.append(a),a=angular.element('<div class="btn-group">');var f=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-trash-o"></i></button>');f.on("click",function(t){t.preventDefault(),e.remove(),o()}),a.append(f),i.append(a),n.showPopover(e),n.showResizeOverlay(e)},aOnSelectAction:function(n,o,i){n.preventDefault(),i.displayElements.popover.css("width","436px");var a=i.displayElements.popoverContainer;a.empty(),a.css("line-height","28px");var l=angular.element('<a href="'+o.attr("href")+'" target="_blank">'+o.attr("href")+"</a>");l.css({display:"inline-block","max-width":"200px",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap","vertical-align":"middle"}),a.append(l);var r=angular.element('<div class="btn-group pull-right">'),u=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" tabindex="-1" unselectable="on" title="'+e.editLink.reLinkButton.tooltip+'"><i class="fa fa-edit icon-edit"></i></button>');u.on("click",function(n){n.preventDefault();var a=t.prompt(e.insertLink.dialogPrompt,o.attr("href"));a&&""!==a&&"http://"!==a&&(o.attr("href",a),i.updateTaBindtaTextElement()),i.hidePopover()}),r.append(u);var s=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" tabindex="-1" unselectable="on" title="'+e.editLink.unLinkButton.tooltip+'"><i class="fa fa-unlink icon-unlink"></i></button>');s.on("click",function(t){t.preventDefault(),o.replaceWith(o.contents()),i.updateTaBindtaTextElement(),i.hidePopover()}),r.append(s);var c=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" tabindex="-1" unselectable="on">'+e.editLink.targetToggle.buttontext+"</button>");"_blank"===o.attr("target")&&c.addClass("active"),c.on("click",function(t){t.preventDefault(),o.attr("target","_blank"===o.attr("target")?"":"_blank"),c.toggleClass("active"),i.updateTaBindtaTextElement()}),r.append(c),a.append(r),i.showPopover(o)},extractYoutubeVideoId:function(t){var e=/(?:youtube(?:-nocookie)?\.com\/(?:[^\/\n\s]+\/\S+\/|(?:v|e(?:mbed)?)\/|\S*?[?&]v=)|youtu\.be\/)([a-zA-Z0-9_-]{11})/i,n=t.match(e);return n&&n[1]||null}}}]).run(["taRegisterTool","$window","taTranslations","taSelection","taToolFunctions","$sanitize","taOptions",function(t,e,n,o,i,a,l){var r={};if(a("",r),l.forceTextAngularSanitize===!0&&"taSanitize"!==r.version)throw angular.$$minErr("textAngular")("textAngularSetup","The textAngular-sanitize provider has been replaced by another -- have you included angular-sanitize by mistake?");t("html",{iconclass:"fa fa-code",tooltiptext:n.html.tooltip,action:function(){this.$editor().switchView()},activeState:function(){return this.$editor().showHtml}});var u=function(t){return function(){return this.$editor().queryFormatBlockState(t)}},s=function(){return this.$editor().wrapSelection("formatBlock","<"+this.name.toUpperCase()+">")};angular.forEach(["h1","h2","h3","h4","h5","h6"],function(e){t(e.toLowerCase(),{buttontext:e.toUpperCase(),tooltiptext:n.heading.tooltip+e.charAt(1),action:s,activeState:u(e.toLowerCase())})}),t("p",{buttontext:"P",tooltiptext:n.p.tooltip,action:function(){return this.$editor().wrapSelection("formatBlock","<P>")},activeState:function(){return this.$editor().queryFormatBlockState("p")}}),t("pre",{buttontext:"pre",tooltiptext:n.pre.tooltip,action:function(){return this.$editor().wrapSelection("formatBlock","<PRE>")},activeState:function(){return this.$editor().queryFormatBlockState("pre")}}),t("ul",{iconclass:"fa fa-list-ul",tooltiptext:n.ul.tooltip,action:function(){return this.$editor().wrapSelection("insertUnorderedList",null)},activeState:function(){return this.$editor().queryCommandState("insertUnorderedList")}}),t("ol",{iconclass:"fa fa-list-ol",tooltiptext:n.ol.tooltip,action:function(){return this.$editor().wrapSelection("insertOrderedList",null)},activeState:function(){return this.$editor().queryCommandState("insertOrderedList")}}),t("quote",{iconclass:"fa fa-quote-right",tooltiptext:n.quote.tooltip,action:function(){return this.$editor().wrapSelection("formatBlock","<BLOCKQUOTE>")},activeState:function(){return this.$editor().queryFormatBlockState("blockquote")}}),t("undo",{iconclass:"fa fa-undo",tooltiptext:n.undo.tooltip,action:function(){return this.$editor().wrapSelection("undo",null)}}),t("redo",{iconclass:"fa fa-repeat",tooltiptext:n.redo.tooltip,action:function(){return this.$editor().wrapSelection("redo",null)}}),t("bold",{iconclass:"fa fa-bold",tooltiptext:n.bold.tooltip,action:function(){return this.$editor().wrapSelection("bold",null)},activeState:function(){return this.$editor().queryCommandState("bold")},commandKeyCode:98}),t("justifyLeft",{iconclass:"fa fa-align-left",tooltiptext:n.justifyLeft.tooltip,action:function(){return this.$editor().wrapSelection("justifyLeft",null)},activeState:function(t){if(t&&"#document"===t.nodeName)return!1;var e=!1;return t&&(e="left"===t.css("text-align")||"left"===t.attr("align")||"right"!==t.css("text-align")&&"center"!==t.css("text-align")&&"justify"!==t.css("text-align")&&!this.$editor().queryCommandState("justifyRight")&&!this.$editor().queryCommandState("justifyCenter")&&!this.$editor().queryCommandState("justifyFull")),e=e||this.$editor().queryCommandState("justifyLeft")}}),t("justifyRight",{iconclass:"fa fa-align-right",tooltiptext:n.justifyRight.tooltip,action:function(){return this.$editor().wrapSelection("justifyRight",null)},activeState:function(t){if(t&&"#document"===t.nodeName)return!1;var e=!1;return t&&(e="right"===t.css("text-align")),e=e||this.$editor().queryCommandState("justifyRight")}}),t("justifyFull",{iconclass:"fa fa-align-justify",tooltiptext:n.justifyFull.tooltip,action:function(){return this.$editor().wrapSelection("justifyFull",null)},activeState:function(t){var e=!1;return t&&(e="justify"===t.css("text-align")),e=e||this.$editor().queryCommandState("justifyFull")}}),t("justifyCenter",{iconclass:"fa fa-align-center",tooltiptext:n.justifyCenter.tooltip,action:function(){return this.$editor().wrapSelection("justifyCenter",null)},activeState:function(t){if(t&&"#document"===t.nodeName)return!1;var e=!1;return t&&(e="center"===t.css("text-align")),e=e||this.$editor().queryCommandState("justifyCenter")}}),t("indent",{iconclass:"fa fa-indent",tooltiptext:n.indent.tooltip,action:function(){return this.$editor().wrapSelection("indent",null)},activeState:function(){return this.$editor().queryFormatBlockState("blockquote")},commandKeyCode:"TabKey"}),t("outdent",{iconclass:"fa fa-outdent",tooltiptext:n.outdent.tooltip,action:function(){return this.$editor().wrapSelection("outdent",null)},activeState:function(){return!1},commandKeyCode:"ShiftTabKey"}),t("italics",{iconclass:"fa fa-italic",tooltiptext:n.italic.tooltip,action:function(){return this.$editor().wrapSelection("italic",null)},activeState:function(){return this.$editor().queryCommandState("italic")},commandKeyCode:105}),t("underline",{iconclass:"fa fa-underline",tooltiptext:n.underline.tooltip,action:function(){return this.$editor().wrapSelection("underline",null)},activeState:function(){return this.$editor().queryCommandState("underline")},commandKeyCode:117}),t("strikeThrough",{iconclass:"fa fa-strikethrough",tooltiptext:n.strikeThrough.tooltip,action:function(){return this.$editor().wrapSelection("strikeThrough",null)},activeState:function(){return document.queryCommandState("strikeThrough")}}),t("clear",{iconclass:"fa fa-ban",tooltiptext:n.clear.tooltip,action:function(t,e){var n;this.$editor().wrapSelection("removeFormat",null);var i=angular.element(o.getSelectionElement()),a=function(t){t=angular.element(t);var e=t;angular.forEach(t.children(),function(t){var n=angular.element("<p></p>");n.html(angular.element(t).html()),e.after(n),e=n}),t.remove()};if(angular.forEach(i.find("ul"),a),angular.forEach(i.find("ol"),a),"li"===i[0].tagName.toLowerCase()){var l=i[0].parentNode.childNodes,r=[],u=[],s=!1;for(n=0;n<l.length;n++)l[n]===i[0]?s=!0:s?u.push(l[n]):r.push(l[n]);var c=angular.element(i[0].parentNode),d=angular.element("<p></p>");if(d.html(angular.element(i[0]).html()),0===r.length||0===u.length)0===u.length?c.after(d):c[0].parentNode.insertBefore(d[0],c[0]),0===r.length&&0===u.length?c.remove():angular.element(i[0]).remove();else{var p=angular.element("<"+c[0].tagName+"></"+c[0].tagName+">"),f=angular.element("<"+c[0].tagName+"></"+c[0].tagName+">");for(n=0;n<r.length;n++)p.append(angular.element(r[n]));for(n=0;n<u.length;n++)f.append(angular.element(u[n]));c.after(f),c.after(d),c.after(p),c.remove()}o.setSelectionToElementEnd(d[0])}var m=this.$editor(),h=function(t){t=angular.element(t),t[0]!==m.displayElements.text[0]&&t.removeAttr("class"),angular.forEach(t.children(),h)};angular.forEach(i,h),"li"!==i[0].tagName.toLowerCase()&&"ol"!==i[0].tagName.toLowerCase()&&"ul"!==i[0].tagName.toLowerCase()&&this.$editor().wrapSelection("formatBlock","default"),e()}}),t("insertImage",{iconclass:"fa fa-picture-o",tooltiptext:n.insertImage.tooltip,action:function(){var t;return t=e.prompt(n.insertImage.dialogPrompt,"http://"),t&&""!==t&&"http://"!==t?this.$editor().wrapSelection("insertImage",t,!0):void 0},onElementSelect:{element:"img",action:i.imgOnSelectAction}}),t("insertVideo",{iconclass:"fa fa-youtube-play",tooltiptext:n.insertVideo.tooltip,action:function(){var t;if(t=e.prompt(n.insertVideo.dialogPrompt,"https://"),t&&""!==t&&"https://"!==t&&(videoId=i.extractYoutubeVideoId(t),videoId)){var o="https://www.youtube.com/embed/"+videoId,a='<img class="ta-insert-video" src="https://img.youtube.com/vi/'+videoId+'/hqdefault.jpg" ta-insert-video="'+o+'" contenteditable="false" allowfullscreen="true" frameborder="0" />';return this.$editor().wrapSelection("insertHTML",a,!0)}},onElementSelect:{element:"img",onlyWithAttrs:["ta-insert-video"],action:i.imgOnSelectAction}}),t("insertLink",{tooltiptext:n.insertLink.tooltip,iconclass:"fa fa-link",action:function(){var t;return t=e.prompt(n.insertLink.dialogPrompt,"http://"),t&&""!==t&&"http://"!==t?this.$editor().wrapSelection("createLink",t,!0):void 0},activeState:function(t){return t?"A"===t[0].tagName:!1},onElementSelect:{element:"a",action:i.aOnSelectAction}}),t("wordcount",{display:'<div id="toolbarWC" style="display:block; min-width:100px;">Words: <span ng-bind="wordcount"></span></div>',disabled:!0,wordcount:0,activeState:function(){var t=this.$editor().displayElements.text,e=t[0].innerHTML||"",n=0;return""!==e.replace(/\s*<[^>]*?>\s*/g,"")&&(n=e.replace(/<\/?(b|i|em|strong|span|u|strikethrough|a|img|small|sub|sup|label)( [^>*?])?>/gi,"").replace(/(<[^>]*?>\s*<[^>]*?>)/gi," ").replace(/(<[^>]*?>)/gi,"").replace(/\s+/gi," ").match(/\S+/g).length),this.wordcount=n,this.$editor().wordcount=n,!1}}),t("charcount",{display:'<div id="toolbarCC" style="display:block; min-width:120px;">Characters: <span ng-bind="charcount"></span></div>',disabled:!0,charcount:0,activeState:function(){var t=this.$editor().displayElements.text,e=t[0].innerText||t[0].textContent,n=e.replace(/(\r\n|\n|\r)/gm,"").replace(/^\s+/g," ").replace(/\s+$/g," ").length;return this.charcount=n,this.$editor().charcount=n,!1}})}]);
var dropFired=!1,textAngular=angular.module("textAngular",["ngSanitize","textAngularSetup","textAngular.factories","textAngular.DOM","textAngular.validators","textAngular.taBind"]);textAngular.config([function(){angular.forEach(taTools,function(e,t){delete taTools[t]})}]),textAngular.directive("textAngular",["$compile","$timeout","taOptions","taSelection","taExecCommand","textAngularManager","$document","$animate","$log","$q","$parse",function(e,t,a,l,n,o,r,s,i,d,u){return{require:"?ngModel",scope:{},restrict:"EA",priority:2,link:function(p,c,m,f){var y,h,E,v,g,b,x,T,w,S,A,C=m.serial?m.serial:Math.floor(1e16*Math.random());p._name=m.name?m.name:"textAngularEditor"+C,angular.element(c).addClass("md-whiteframe-3dp");var $=function(e,a,l){t(function(){var t=function(){e.off(a,t),l.apply(this,arguments)};e.on(a,t)},100)};if(w=n(m.taDefaultWrap),angular.extend(p,angular.copy(a),{wrapSelection:function(e,t,a){"undo"===e.toLowerCase()?p["$undoTaBindtaTextElement"+C]():"redo"===e.toLowerCase()?p["$redoTaBindtaTextElement"+C]():(w(e,!1,t,p.defaultTagAttributes),a&&p["reApplyOnSelectorHandlerstaTextElement"+C](),p.displayElements.text[0].focus())},showHtml:p.$eval(m.taShowHtml)||!1}),m.taFocussedClass&&(p.classes.focussed=m.taFocussedClass),m.taTextEditorClass&&(p.classes.textEditor=m.taTextEditorClass),m.taHtmlEditorClass&&(p.classes.htmlEditor=m.taHtmlEditorClass),m.taDefaultTagAttributes)try{angular.extend(p.defaultTagAttributes,angular.fromJson(m.taDefaultTagAttributes))}catch(H){i.error(H)}m.taTextEditorSetup&&(p.setup.textEditorSetup=p.$parent.$eval(m.taTextEditorSetup)),m.taHtmlEditorSetup&&(p.setup.htmlEditorSetup=p.$parent.$eval(m.taHtmlEditorSetup)),m.taFileDrop?p.fileDropHandler=p.$parent.$eval(m.taFileDrop):p.fileDropHandler=p.defaultFileDropHandler,x=c[0].innerHTML,c[0].innerHTML="",p.displayElements={forminput:angular.element("<input type='hidden' tabindex='-1' style='display: none;'>"),html:angular.element("<textarea></textarea>"),text:angular.element("<div></div>"),scrollWindow:angular.element("<div class='ta-scroll-window'></div>"),popover:angular.element('<div class="popover fade bottom" style="max-width: none; width: 305px;"></div>'),popoverArrow:angular.element('<div class="arrow"></div>'),popoverContainer:angular.element('<div class="popover-content"></div>'),resize:{overlay:angular.element('<div class="ta-resizer-handle-overlay"></div>'),background:angular.element('<div class="ta-resizer-handle-background"></div>'),anchors:[angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-tl"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-tr"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-bl"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-br"></div>')],info:angular.element('<div class="ta-resizer-handle-info"></div>')}},p.displayElements.popover.append(p.displayElements.popoverArrow),p.displayElements.popover.append(p.displayElements.popoverContainer),p.displayElements.scrollWindow.append(p.displayElements.popover),p.displayElements.popover.on("mousedown",function(e,t){return t&&angular.extend(e,t),e.preventDefault(),!1}),p.showPopover=function(e){p.displayElements.popover.css("display","block"),p.reflowPopover(e),s.addClass(p.displayElements.popover,"in"),$(r.find("body"),"click keyup",function(){p.hidePopover()})},p.reflowPopover=function(e){p.displayElements.text[0].offsetHeight-51>e[0].offsetTop?(p.displayElements.popover.css("top",e[0].offsetTop+e[0].offsetHeight+p.displayElements.scrollWindow[0].scrollTop+"px"),p.displayElements.popover.removeClass("top").addClass("bottom")):(p.displayElements.popover.css("top",e[0].offsetTop-54+p.displayElements.scrollWindow[0].scrollTop+"px"),p.displayElements.popover.removeClass("bottom").addClass("top"));var t=p.displayElements.text[0].offsetWidth-p.displayElements.popover[0].offsetWidth,a=e[0].offsetLeft+e[0].offsetWidth/2-p.displayElements.popover[0].offsetWidth/2;p.displayElements.popover.css("left",Math.max(0,Math.min(t,a))+"px"),p.displayElements.popoverArrow.css("margin-left",Math.min(a,Math.max(0,a-t))-11+"px")},p.hidePopover=function(){p.displayElements.popover.css("display",""),p.displayElements.popoverContainer.attr("style",""),p.displayElements.popoverContainer.attr("class","popover-content"),p.displayElements.popover.removeClass("in")},p.displayElements.resize.overlay.append(p.displayElements.resize.background),angular.forEach(p.displayElements.resize.anchors,function(e){p.displayElements.resize.overlay.append(e)}),p.displayElements.resize.overlay.append(p.displayElements.resize.info),p.displayElements.scrollWindow.append(p.displayElements.resize.overlay),p.reflowResizeOverlay=function(e){e=angular.element(e)[0],p.displayElements.resize.overlay.css({display:"block",left:e.offsetLeft-5+"px",top:e.offsetTop-5+"px",width:e.offsetWidth+10+"px",height:e.offsetHeight+10+"px"}),p.displayElements.resize.info.text(e.offsetWidth+" x "+e.offsetHeight)},p.showResizeOverlay=function(e){var t=r.find("body");S=function(a){var l={width:parseInt(e.attr("width")),height:parseInt(e.attr("height")),x:a.clientX,y:a.clientY};(void 0===l.width||isNaN(l.width))&&(l.width=e[0].offsetWidth),(void 0===l.height||isNaN(l.height))&&(l.height=e[0].offsetHeight),p.hidePopover();var n=l.height/l.width,o=function(t){function a(e){return Math.round(Math.max(0,e))}var o={x:Math.max(0,l.width+(t.clientX-l.x)),y:Math.max(0,l.height+(t.clientY-l.y))},r=void 0!==m.taResizeForceAspectRatio,s=m.taResizeMaintainAspectRatio,i=r||s&&!t.shiftKey;if(i){var d=o.y/o.x;o.x=n>d?o.x:o.y/n,o.y=n>d?o.x*n:o.y}var u=angular.element(e);u.css("height",a(o.y)+"px"),u.css("width",a(o.x)+"px"),p.reflowResizeOverlay(e)};t.on("mousemove",o),$(t,"mouseup",function(e){e.preventDefault(),e.stopPropagation(),t.off("mousemove",o),p.$apply(function(){p.hidePopover(),p.updateTaBindtaTextElement()},100)}),a.stopPropagation(),a.preventDefault()},p.displayElements.resize.anchors[3].off("mousedown"),p.displayElements.resize.anchors[3].on("mousedown",S),p.reflowResizeOverlay(e),$(t,"click",function(){p.hideResizeOverlay()})},p.hideResizeOverlay=function(){p.displayElements.resize.anchors[3].off("mousedown",S),p.displayElements.resize.overlay.css("display","")},p.setup.htmlEditorSetup(p.displayElements.html),p.setup.textEditorSetup(p.displayElements.text),p.displayElements.html.attr({id:"taHtmlElement"+C,"ng-show":"showHtml","ta-bind":"ta-bind","ng-model":"html","ng-model-options":c.attr("ng-model-options")}),p.displayElements.text.attr({id:"taTextElement"+C,contentEditable:"true","ta-bind":"ta-bind","ng-model":"html","ng-model-options":c.attr("ng-model-options")}),p.displayElements.scrollWindow.attr({"ng-hide":"showHtml"}),m.taDefaultWrap&&p.displayElements.text.attr("ta-default-wrap",m.taDefaultWrap),m.taUnsafeSanitizer&&(p.displayElements.text.attr("ta-unsafe-sanitizer",m.taUnsafeSanitizer),p.displayElements.html.attr("ta-unsafe-sanitizer",m.taUnsafeSanitizer)),p.displayElements.scrollWindow.append(p.displayElements.text),c.append(p.displayElements.scrollWindow),c.append(p.displayElements.html),p.displayElements.forminput.attr("name",p._name),c.append(p.displayElements.forminput),m.tabindex&&(c.removeAttr("tabindex"),p.displayElements.text.attr("tabindex",m.tabindex),p.displayElements.html.attr("tabindex",m.tabindex)),m.placeholder&&(p.displayElements.text.attr("placeholder",m.placeholder),p.displayElements.html.attr("placeholder",m.placeholder)),m.taDisabled&&(p.displayElements.text.attr("ta-readonly","disabled"),p.displayElements.html.attr("ta-readonly","disabled"),p.disabled=p.$parent.$eval(m.taDisabled),p.$parent.$watch(m.taDisabled,function(e){p.disabled=e,p.disabled?c.addClass(p.classes.disabled):c.removeClass(p.classes.disabled)})),m.taPaste&&(p._pasteHandler=function(e){return u(m.taPaste)(p.$parent,{$html:e})},p.displayElements.text.attr("ta-paste","_pasteHandler($html)")),e(p.displayElements.scrollWindow)(p),e(p.displayElements.html)(p),p.updateTaBindtaTextElement=p["updateTaBindtaTextElement"+C],p.updateTaBindtaHtmlElement=p["updateTaBindtaHtmlElement"+C],c.addClass("ta-root"),p.displayElements.scrollWindow.addClass("ta-text ta-editor "+p.classes.textEditor),p.displayElements.html.addClass("ta-html ta-editor "+p.classes.htmlEditor),p._actionRunning=!1;var D=!1;if(p.startAction=function(){return p._actionRunning=!0,D=rangy.saveSelection(),function(){D&&rangy.restoreSelection(D)}},p.endAction=function(){p._actionRunning=!1,D&&(p.showHtml?p.displayElements.html[0].focus():p.displayElements.text[0].focus(),rangy.removeMarkers(D)),D=!1,p.updateSelectedStyles(),p.showHtml||p["updateTaBindtaTextElement"+C]()},g=function(){p.focussed=!0,c.addClass(p.classes.focussed),T.focus(),c.triggerHandler("focus")},p.displayElements.html.on("focus",g),p.displayElements.text.on("focus",g),b=function(e){return p._actionRunning||r[0].activeElement===p.displayElements.html[0]||r[0].activeElement===p.displayElements.text[0]||(c.removeClass(p.classes.focussed),T.unfocus(),t(function(){p._bUpdateSelectedStyles=!1,c.triggerHandler("blur"),p.focussed=!1},0)),e.preventDefault(),!1},p.displayElements.html.on("blur",b),p.displayElements.text.on("blur",b),p.displayElements.text.on("paste",function(e){c.triggerHandler("paste",e)}),p.queryFormatBlockState=function(e){return!p.showHtml&&e.toLowerCase()===r[0].queryCommandValue("formatBlock").toLowerCase()},p.queryCommandState=function(e){return p.showHtml?"":r[0].queryCommandState(e)},p.switchView=function(){p.showHtml=!p.showHtml,s.enabled(!1,p.displayElements.html),s.enabled(!1,p.displayElements.text),p.showHtml?t(function(){return s.enabled(!0,p.displayElements.html),s.enabled(!0,p.displayElements.text),p.displayElements.html[0].focus()},100):t(function(){return s.enabled(!0,p.displayElements.html),s.enabled(!0,p.displayElements.text),p.displayElements.text[0].focus()},100)},m.ngModel){var z=!0;f.$render=function(){if(z){z=!1;var e=p.$parent.$eval(m.ngModel);void 0!==e&&null!==e||!x||""===x||f.$setViewValue(x)}p.displayElements.forminput.val(f.$viewValue),p.html=f.$viewValue||""},c.attr("required")&&(f.$validators.required=function(e,t){var a=e||t;return!(!a||""===a.trim())})}else p.displayElements.forminput.val(x),p.html=x;if(p.$watch("html",function(e,t){e!==t&&(m.ngModel&&f.$viewValue!==e&&f.$setViewValue(e),p.displayElements.forminput.val(e))}),m.taTargetToolbars)T=o.registerEditor(p._name,p,m.taTargetToolbars.split(","));else{var _=angular.element('<md-toolbar layout="layout-wrap" text-angular-toolbar name="textAngularToolbar'+C+'">');m.taToolbar&&_.attr("ta-toolbar",m.taToolbar),m.taToolbarClass&&_.attr("ta-toolbar-class",m.taToolbarClass),m.taToolbarGroupClass&&_.attr("ta-toolbar-group-class",m.taToolbarGroupClass),m.taToolbarButtonClass&&_.attr("ta-toolbar-button-class",m.taToolbarButtonClass),m.taToolbarActiveButtonClass&&_.attr("ta-toolbar-active-button-class",m.taToolbarActiveButtonClass),m.taFocussedClass&&_.attr("ta-focussed-class",m.taFocussedClass),_.hasClass("layout-wrap")||_.addClass("layout-wrap"),c.prepend(_),e(_)(p.$parent),T=o.registerEditor(p._name,p,["textAngularToolbar"+C])}p.$on("$destroy",function(){o.unregisterEditor(p._name),angular.element(window).off("blur")}),p.$on("ta-element-select",function(e,t){T.triggerElementSelect(e,t)&&p["reApplyOnSelectorHandlerstaTextElement"+C]()}),p.$on("ta-drop-event",function(e,a,l,n){p.displayElements.text[0].focus(),n&&n.files&&n.files.length>0?(angular.forEach(n.files,function(e){try{d.when(p.fileDropHandler(e,p.wrapSelection)||p.fileDropHandler!==p.defaultFileDropHandler&&d.when(p.defaultFileDropHandler(e,p.wrapSelection))).then(function(){p["updateTaBindtaTextElement"+C]()})}catch(t){i.error(t)}}),l.preventDefault(),l.stopPropagation()):t(function(){p["updateTaBindtaTextElement"+C]()},0)}),p._bUpdateSelectedStyles=!1,angular.element(window).on("blur",function(){p._bUpdateSelectedStyles=!1,p.focussed=!1}),p.updateSelectedStyles=function(){var e;A&&t.cancel(A),void 0!==(e=l.getSelectionElement())&&e.parentNode!==p.displayElements.text[0]?T.updateSelectedStyles(angular.element(e)):T.updateSelectedStyles(),p._bUpdateSelectedStyles&&(A=t(p.updateSelectedStyles,200))},y=function(){return p.focussed?void(p._bUpdateSelectedStyles||(p._bUpdateSelectedStyles=!0,p.$apply(function(){p.updateSelectedStyles()}))):void(p._bUpdateSelectedStyles=!1)},p.displayElements.html.on("keydown",y),p.displayElements.text.on("keydown",y),h=function(){p._bUpdateSelectedStyles=!1},p.displayElements.html.on("keyup",h),p.displayElements.text.on("keyup",h),E=function(e,t){t&&angular.extend(e,t),p.$apply(function(){return T.sendKeyCommand(e)?(p._bUpdateSelectedStyles||p.updateSelectedStyles(),e.preventDefault(),!1):void 0})},p.displayElements.html.on("keypress",E),p.displayElements.text.on("keypress",E),v=function(){p._bUpdateSelectedStyles=!1,p.$apply(function(){p.updateSelectedStyles()})},p.displayElements.html.on("mouseup",v),p.displayElements.text.on("mouseup",v)}}}]),textAngular.service("textAngularManager",["taToolExecuteAction","taTools","taRegisterTool",function(e,t,a){var l={},n={};return{registerEditor:function(a,o,r){if(!a||""===a)throw"textAngular Error: An editor requires a name";if(!o)throw"textAngular Error: An editor requires a scope";if(n[a])throw'textAngular Error: An Editor with name "'+a+'" already exists';var s=[];return angular.forEach(r,function(e){l[e]&&s.push(l[e])}),n[a]={scope:o,toolbars:r,_registerToolbar:function(e){this.toolbars.indexOf(e.name)>=0&&s.push(e)},editorFunctions:{disable:function(){angular.forEach(s,function(e){e.disabled=!0})},enable:function(){angular.forEach(s,function(e){e.disabled=!1})},focus:function(){angular.forEach(s,function(e){e._parent=o,e.disabled=!1,e.focussed=!0,o.focussed=!0})},unfocus:function(){angular.forEach(s,function(e){e.disabled=!0,e.focussed=!1}),o.focussed=!1},updateSelectedStyles:function(e){angular.forEach(s,function(t){angular.forEach(t.tools,function(a){a.activeState&&(t._parent=o,a.active=a.activeState(e))})})},sendKeyCommand:function(a){var l=!1;return(a.ctrlKey||a.metaKey||a.specialKey)&&angular.forEach(t,function(t,n){if(t.commandKeyCode&&(t.commandKeyCode===a.which||t.commandKeyCode===a.specialKey))for(var r=0;r<s.length;r++)if(void 0!==s[r].tools[n]){e.call(s[r].tools[n],o),l=!0;break}}),l},triggerElementSelect:function(e,a){var l=function(e,t){for(var a=!0,l=0;l<t.length;l++)a=a&&e.attr(t[l]);return a},n=[],r={},i=!1;a=angular.element(a);var d=!1;if(angular.forEach(t,function(e,t){e.onElementSelect&&e.onElementSelect.element&&e.onElementSelect.element.toLowerCase()===a[0].tagName.toLowerCase()&&(!e.onElementSelect.filter||e.onElementSelect.filter(a))&&(d=d||angular.isArray(e.onElementSelect.onlyWithAttrs)&&l(a,e.onElementSelect.onlyWithAttrs),e.onElementSelect.onlyWithAttrs&&!l(a,e.onElementSelect.onlyWithAttrs)||(r[t]=e))}),d?(angular.forEach(r,function(e,t){e.onElementSelect.onlyWithAttrs&&l(a,e.onElementSelect.onlyWithAttrs)&&n.push({name:t,tool:e})}),n.sort(function(e,t){return t.tool.onElementSelect.onlyWithAttrs.length-e.tool.onElementSelect.onlyWithAttrs.length})):angular.forEach(r,function(e,t){n.push({name:t,tool:e})}),n.length>0)for(var u=0;u<n.length;u++){for(var p=n[u].tool,c=n[u].name,m=0;m<s.length;m++)if(void 0!==s[m].tools[c]){p.onElementSelect.action.call(s[m].tools[c],e,a,o),i=!0;break}if(i)break}return i}}},n[a].editorFunctions},retrieveEditor:function(e){return n[e]},unregisterEditor:function(e){delete n[e]},registerToolbar:function(e){if(!e)throw"textAngular Error: A toolbar requires a scope";if(!e.name||""===e.name)throw"textAngular Error: A toolbar requires a name";if(l[e.name])throw'textAngular Error: A toolbar with name "'+e.name+'" already exists';l[e.name]=e,angular.forEach(n,function(t){t._registerToolbar(e)})},retrieveToolbar:function(e){return l[e]},retrieveToolbarsViaEditor:function(e){var t=[],a=this;return angular.forEach(this.retrieveEditor(e).toolbars,function(e){t.push(a.retrieveToolbar(e))}),t},unregisterToolbar:function(e){delete l[e]},updateToolsDisplay:function(e){var t=this;angular.forEach(e,function(e,a){t.updateToolDisplay(a,e)})},resetToolsDisplay:function(){var e=this;angular.forEach(t,function(t,a){e.resetToolDisplay(a)})},updateToolDisplay:function(e,t){var a=this;angular.forEach(l,function(l,n){a.updateToolbarToolDisplay(n,e,t)})},resetToolDisplay:function(e){var t=this;angular.forEach(l,function(a,l){t.resetToolbarToolDisplay(l,e)})},updateToolbarToolDisplay:function(e,t,a){if(!l[e])throw'textAngular Error: No Toolbar with name "'+e+'" exists';l[e].updateToolDisplay(t,a)},resetToolbarToolDisplay:function(e,a){if(!l[e])throw'textAngular Error: No Toolbar with name "'+e+'" exists';l[e].updateToolDisplay(a,t[a],!0)},removeTool:function(e){delete t[e],angular.forEach(l,function(t){delete t.tools[e];for(var a=0;a<t.toolbar.length;a++){for(var l,n=0;n<t.toolbar[a].length;n++){if(t.toolbar[a][n]===e){l={group:a,index:n};break}if(void 0!==l)break}void 0!==l&&(t.toolbar[l.group].slice(l.index,1),t._$element.children().eq(l.group).children().eq(l.index).remove())}})},addTool:function(e,t,n,o){a(e,t),angular.forEach(l,function(a){a.addTool(e,t,n,o)})},addToolToToolbar:function(e,t,n,o,r){a(e,t),l[n].addTool(e,t,o,r)},refreshEditor:function(e){if(!n[e])throw'textAngular Error: No Editor with name "'+e+'" exists';n[e].scope.updateTaBindtaTextElement(),n[e].scope.$$phase||n[e].scope.$digest()},sendKeyCommand:function(e,t){var a=n[e._name];return a&&a.editorFunctions.sendKeyCommand(t)?(e._bUpdateSelectedStyles||e.updateSelectedStyles(),t.preventDefault(),!1):void 0}}}]),textAngular.directive("textAngularToolbar",["$compile","textAngularManager","taOptions","taTools","taToolExecuteAction","$window",function(e,t,a,l,n,o){return{scope:{name:"@"},restrict:"EA",link:function(r,s,i){if(!r.name||""===r.name)throw"textAngular Error: A toolbar requires a name";angular.extend(r,angular.copy(a)),i.taToolbar&&(r.toolbar=r.$parent.$eval(i.taToolbar)),i.taToolbarClass&&(r.classes.toolbar=i.taToolbarClass),i.taToolbarGroupClass&&(r.classes.toolbarGroup=i.taToolbarGroupClass),i.taToolbarButtonClass&&(r.classes.toolbarButton=i.taToolbarButtonClass),i.taToolbarActiveButtonClass&&(r.classes.toolbarButtonActive=i.taToolbarActiveButtonClass),i.taFocussedClass&&(r.classes.focussed=i.taFocussedClass),r.disabled=!0,r.focussed=!1,r._$element=s,s[0].innerHTML="",s.addClass("ta-toolbar "+r.classes.toolbar),r.$watch("focussed",function(){r.focussed?s.addClass(r.classes.focussed):s.removeClass(r.classes.focussed)});var d=function(t,a,l){var n;n=t&&t.display?angular.element(t.display):angular.element("<md-button>");var o=r.classes.toolbarButton;if("html"==l?o+=" md-primary md-hue-2":"bold"==l?o+=" md-primary md-hue-3":"justifyLeft"==l&&(o+=" md-primary md-hue-1"),t&&t["class"]?n.addClass(t["class"]):n.addClass(o),n.attr("name",a.name),n.attr("ta-button","ta-button"),n.attr("ng-disabled","isDisabled()"),n.attr("tabindex","-1"),n.attr("ng-click","executeAction()"),n.attr("ng-class","displayActiveToolClass(active)"),t&&t.tooltiptext&&n.attr("title",t.tooltiptext),t&&!t.display&&!a._display&&(n[0].innerHTML="",t.buttontext&&(n[0].innerHTML=t.buttontext),t.iconclass)){var s=angular.element("<i>"),i=n[0].innerHTML;s.addClass(t.iconclass),n[0].innerHTML="",n.append(s),i&&""!==i&&n.append("&nbsp;"+i)}return a._lastToolDefinition=angular.copy(t),e(n)(a)};r.tools={},r._parent={disabled:!0,showHtml:!1,queryFormatBlockState:function(){return!1},queryCommandState:function(){return!1}};var u={$window:o,$editor:function(){return r._parent},isDisabled:function(){return"function"!=typeof this.$eval("disabled")&&this.$eval("disabled")||this.$eval("disabled()")||"html"!==this.name&&this.$editor().showHtml||this.$parent.disabled||this.$editor().disabled},displayActiveToolClass:function(e){return e?r.classes.toolbarButtonActive:""},executeAction:n};angular.forEach(r.toolbar,function(e){var t=angular.element('<div layout="row" flex="50">');t.addClass(r.classes.toolbarGroup),angular.forEach(e,function(a){r.tools[a]=angular.extend(r.$new(!0),l[a],u,{name:a}),r.tools[a].$element=d(l[a],r.tools[a],e[0]),t.append(r.tools[a].$element)}),s.append(t)}),r.updateToolDisplay=function(e,t,a){var l=r.tools[e];if(l){if(l._lastToolDefinition&&!a&&(t=angular.extend({},l._lastToolDefinition,t)),null===t.buttontext&&null===t.iconclass&&null===t.display)throw'textAngular Error: Tool Definition for updating "'+e+'" does not have a valid display/iconclass/buttontext value';null===t.buttontext&&delete t.buttontext,null===t.iconclass&&delete t.iconclass,null===t.display&&delete t.display;var n=d(t,l);l.$element.replaceWith(n),l.$element=n}},r.addTool=function(e,t,a,n){r.tools[e]=angular.extend(r.$new(!0),l[e],u,{name:e}),r.tools[e].$element=d(l[e],r.tools[e]);var o;void 0===a&&(a=r.toolbar.length-1),o=angular.element(s.children()[a]),void 0===n?(o.append(r.tools[e].$element),r.toolbar[a][r.toolbar[a].length-1]=e):(o.children().eq(n).after(r.tools[e].$element),r.toolbar[a][n]=e)},t.registerToolbar(r),r.$on("$destroy",function(){t.unregisterToolbar(r.name)})}}}]);